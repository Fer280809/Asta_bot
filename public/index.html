<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>AstaFile Pro - Panel de Control Premium</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@300;400;500&family=Orbitron:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="/socket.io/socket.io.js"></script>
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a25;
            --accent-primary: #ff2e63;
            --accent-secondary: #7d5fff;
            --accent-tertiary: #00d4ff;
            --text-primary: #e4e7ec;
            --text-secondary: #9ca3af;
            --border: rgba(255, 255, 255, 0.1);
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --gradient-primary: linear-gradient(135deg, #ff2e63 0%, #7d5fff 50%, #00d4ff 100%);
            --gradient-secondary: linear-gradient(135deg, #7d5fff 0%, #00d4ff 100%);
        }

        [data-theme="light"] {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --accent-primary: #3b82f6;
            --accent-secondary: #8b5cf6;
            --accent-tertiary: #06b6d4;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border: rgba(0, 0, 0, 0.1);
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            --card-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --glass-bg: rgba(255, 255, 255, 0.8);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Inter', system-ui, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            transition: var(--transition);
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(255, 46, 99, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(125, 95, 255, 0.15) 0%, transparent 50%);
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><circle cx="12" cy="12" r="6" fill="%23ff2e63" opacity="0.7"/></svg>') 12 12, auto;
        }

        /* Animaciones */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 46, 99, 0.3); }
            50% { box-shadow: 0 0 40px rgba(255, 46, 99, 0.6); }
        }

        @keyframes slideIn {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }

        @keyframes wave {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Loading Screen */
        .loading-spinner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            transition: opacity 0.5s;
        }

        .spinner {
            width: 80px;
            height: 80px;
            border: 4px solid var(--border);
            border-top: 4px solid var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Login Screen Mejorado */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--bg-primary) 0%, #1a0a1a 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.5s, visibility 0.5s;
            overflow: hidden;
        }

        .login-screen::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 46, 99, 0.1) 50%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        .login-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .login-box {
            background: rgba(18, 18, 26, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 25px;
            padding: 50px;
            width: 90%;
            max-width: 450px;
            box-shadow: var(--card-shadow);
            position: relative;
            overflow: hidden;
            animation: slideIn 0.6s ease-out;
            border-top: 4px solid var(--accent-primary);
        }

        .login-box h1 {
            text-align: center;
            margin-bottom: 15px;
            font-size: 2.5rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
        }

        .login-box p {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 40px;
            font-size: 1.1rem;
        }

        .input-group {
            margin-bottom: 25px;
            position: relative;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            font-size: 0.95rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 16px 20px;
            background: rgba(26, 26, 37, 0.7);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: var(--transition);
            font-family: 'Inter', sans-serif;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(255, 46, 99, 0.2);
            background: rgba(26, 26, 37, 0.9);
        }

        .input-group i {
            position: absolute;
            right: 20px;
            top: 50px;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .input-group input:focus + i {
            color: var(--accent-primary);
        }

        .btn {
            width: 100%;
            padding: 18px;
            background: var(--gradient-primary);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            letter-spacing: 0.5px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(255, 46, 99, 0.4);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        /* Main Layout */
        .app-container {
            display: none;
            height: 100vh;
            opacity: 0;
            transition: opacity 0.5s;
        }

        .app-container.active {
            display: flex;
            opacity: 1;
        }

        /* Sidebar Moderno */
        .sidebar {
            width: 280px;
            background: rgba(18, 18, 26, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            z-index: 100;
            box-shadow: 5px 0 25px rgba(0, 0, 0, 0.2);
        }

        .sidebar-header {
            padding: 25px;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(135deg, rgba(255, 46, 99, 0.1), rgba(125, 95, 255, 0.1));
        }

        .sidebar-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-family: 'Orbitron', sans-serif;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-menu {
            flex: 1;
            padding: 25px 0;
            overflow-y: auto;
        }

        .nav-item {
            padding: 18px 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: var(--transition);
            border-left: 4px solid transparent;
            margin: 5px 15px;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 46, 99, 0.1), transparent);
            transition: 0.5s;
        }

        .nav-item:hover::before {
            left: 100%;
        }

        .nav-item:hover {
            background: rgba(255, 46, 99, 0.1);
            transform: translateX(5px);
        }

        .nav-item.active {
            background: rgba(255, 46, 99, 0.15);
            border-left-color: var(--accent-primary);
            box-shadow: 0 5px 15px rgba(255, 46, 99, 0.2);
        }

        .nav-item i {
            width: 24px;
            font-size: 1.2rem;
            color: var(--accent-secondary);
            transition: var(--transition);
        }

        .nav-item.active i {
            color: var(--accent-primary);
            transform: scale(1.1);
        }

        .nav-item span {
            font-weight: 500;
            transition: var(--transition);
        }

        .nav-item.active span {
            font-weight: 600;
            color: var(--accent-primary);
        }

        .sidebar-footer {
            padding: 25px;
            border-top: 1px solid var(--border);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.03), transparent);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            transition: var(--transition);
        }

        .user-info:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.3rem;
            box-shadow: 0 5px 15px rgba(255, 46, 99, 0.3);
            animation: float 3s ease-in-out infinite;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .user-role {
            font-size: 0.85rem;
            color: var(--accent-secondary);
            font-weight: 500;
        }

        .logout-btn {
            width: 100%;
            padding: 14px;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            color: var(--error);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 500;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.2);
            border-color: var(--error);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.2);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: rgba(10, 10, 15, 0.7);
        }

        .top-bar {
            height: 70px;
            background: rgba(18, 18, 26, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            position: sticky;
            top: 0;
            z-index: 99;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.2);
        }

        .page-title {
            font-size: 1.4rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-family: 'Orbitron', sans-serif;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .top-actions {
            display: flex;
            gap: 12px;
        }

        .icon-btn {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            background: rgba(26, 26, 37, 0.7);
            border: 1px solid var(--border);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .icon-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: 0.5s;
        }

        .icon-btn:hover::before {
            left: 100%;
        }

        .icon-btn:hover {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            transform: translateY(-3px) rotate(5deg);
            box-shadow: 0 8px 20px rgba(255, 46, 99, 0.3);
        }

        .icon-btn.refreshing i {
            animation: spin 1s linear infinite;
        }

        .content-area {
            flex: 1;
            overflow: hidden;
            position: relative;
            padding: 20px;
            animation: slideIn 0.4s ease-out;
        }

        .view {
            display: none;
            height: 100%;
            overflow-y: auto;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .view.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* Dashboard Premium */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(18, 18, 26, 0.9), rgba(26, 26, 37, 0.9));
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 25px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            animation: slideIn 0.5s ease-out;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--gradient-primary);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-shadow);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .stat-title {
            color: var(--text-secondary);
            font-size: 0.95rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            transition: var(--transition);
        }

        .stat-card:hover .stat-icon {
            transform: scale(1.1) rotate(10deg);
        }

        .stat-icon.purple { background: linear-gradient(135deg, rgba(125, 95, 255, 0.2), rgba(125, 95, 255, 0.4)); color: var(--accent-secondary); }
        .stat-icon.pink { background: linear-gradient(135deg, rgba(255, 46, 99, 0.2), rgba(255, 46, 99, 0.4)); color: var(--accent-primary); }
        .stat-icon.green { background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.4)); color: var(--success); }
        .stat-icon.orange { background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.4)); color: var(--warning); }
        .stat-icon.blue { background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.4)); color: var(--info); }
        .stat-icon.cyan { background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(0, 212, 255, 0.4)); color: var(--accent-tertiary); }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
        }

        .stat-progress {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin: 15px 0;
            overflow: hidden;
        }

        .stat-progress-bar {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 3px;
            width: 0;
            transition: width 1.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .stat-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-trend {
            font-size: 0.85rem;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 600;
        }

        .trend-up { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .trend-down { background: rgba(239, 68, 68, 0.2); color: var(--error); }

        /* File Manager Premium */
        .file-manager {
            display: flex;
            height: 100%;
            gap: 25px;
        }

        .file-sidebar {
            width: 280px;
            background: rgba(18, 18, 26, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px;
            overflow-y: auto;
            transition: var(--transition);
        }

        .file-sidebar:hover {
            box-shadow: var(--card-shadow);
        }

        .file-tree-item {
            padding: 14px 18px;
            cursor: pointer;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 0.95rem;
            transition: var(--transition);
            margin-bottom: 8px;
            position: relative;
            overflow: hidden;
        }

        .file-tree-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 46, 99, 0.1), transparent);
            transition: 0.5s;
        }

        .file-tree-item:hover::before {
            left: 100%;
        }

        .file-tree-item:hover {
            background: rgba(255, 46, 99, 0.1);
            transform: translateX(5px);
        }

        .file-tree-item.active {
            background: rgba(255, 46, 99, 0.2);
            border-left: 4px solid var(--accent-primary);
        }

        .file-tree-item i {
            color: var(--accent-secondary);
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .file-tree-item.active i {
            color: var(--accent-primary);
            transform: scale(1.1);
        }

        .file-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .file-toolbar {
            background: rgba(18, 18, 26, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 18px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .breadcrumb {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
            overflow-x: auto;
            padding: 5px 0;
        }

        .breadcrumb-item {
            color: var(--text-secondary);
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 8px;
            transition: var(--transition);
            white-space: nowrap;
        }

        .breadcrumb-item:hover {
            background: rgba(255, 46, 99, 0.1);
            color: var(--accent-primary);
        }

        .breadcrumb-separator {
            color: var(--text-secondary);
            opacity: 0.5;
        }

        .toolbar-btn {
            padding: 12px 20px;
            background: rgba(26, 26, 37, 0.7);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: var(--transition);
            white-space: nowrap;
            position: relative;
            overflow: hidden;
        }

        .toolbar-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: 0.5s;
        }

        .toolbar-btn:hover::before {
            left: 100%;
        }

        .toolbar-btn:hover {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 46, 99, 0.3);
        }

        .toolbar-btn.danger {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
        }

        .toolbar-btn.danger:hover {
            background: var(--error);
            border-color: var(--error);
        }

        .file-view-toggle {
            display: flex;
            gap: 5px;
            margin-left: auto;
        }

        .view-btn {
            padding: 10px 15px;
            background: rgba(26, 26, 37, 0.7);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
        }

        .view-btn.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .file-list {
            flex: 1;
            background: rgba(18, 18, 26, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 20px;
            overflow: hidden;
            position: relative;
        }

        /* Vista de cuadr√≠cula */
        .file-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            padding: 25px;
        }

        .file-item {
            background: rgba(26, 26, 37, 0.7);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .file-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            transition: 0.5s;
        }

        .file-item:hover::before {
            left: 100%;
        }

        .file-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-shadow);
            border-color: var(--accent-primary);
        }

        .file-item.selected {
            background: rgba(255, 46, 99, 0.15);
            border-color: var(--accent-primary);
        }

        .file-item-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin: 0 auto 15px;
        }

        .file-item.folder .file-item-icon { background: linear-gradient(135deg, rgba(125, 95, 255, 0.2), rgba(125, 95, 255, 0.4)); color: var(--accent-secondary); }
        .file-item.file .file-item-icon { background: linear-gradient(135deg, rgba(255, 46, 99, 0.2), rgba(255, 46, 99, 0.4)); color: var(--accent-primary); }
        .file-item.image .file-item-icon { background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.4)); color: var(--success); }
        .file-item.code .file-item-icon { background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.4)); color: var(--warning); }
        .file-item.audio .file-item-icon { background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.4)); color: var(--info); }
        .file-item.video .file-item-icon { background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(139, 92, 246, 0.4)); color: #8b5cf6; }

        .file-item-name {
            text-align: center;
            font-weight: 500;
            margin-bottom: 10px;
            word-break: break-word;
        }

        .file-item-size {
            text-align: center;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Vista de tabla */
        .file-table {
            width: 100%;
            border-collapse: collapse;
        }

        .file-table th {
            text-align: left;
            padding: 20px;
            border-bottom: 1px solid var(--border);
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.9rem;
            position: sticky;
            top: 0;
            background: rgba(18, 18, 26, 0.95);
            backdrop-filter: blur(20px);
            z-index: 10;
        }

        .file-table td {
            padding: 18px 20px;
            border-bottom: 1px solid var(--border);
            font-size: 0.95rem;
        }

        .file-row {
            cursor: pointer;
            transition: var(--transition);
        }

        .file-row:hover {
            background: rgba(255, 46, 99, 0.05);
        }

        .file-row.selected {
            background: rgba(255, 46, 99, 0.15);
        }

        .file-name-cell {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .file-icon {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            transition: var(--transition);
        }

        .file-row:hover .file-icon {
            transform: scale(1.1) rotate(5deg);
        }

        .file-icon.folder { background: linear-gradient(135deg, rgba(125, 95, 255, 0.2), rgba(125, 95, 255, 0.4)); color: var(--accent-secondary); }
        .file-icon.file { background: linear-gradient(135deg, rgba(255, 46, 99, 0.2), rgba(255, 46, 99, 0.4)); color: var(--accent-primary); }
        .file-icon.image { background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.4)); color: var(--success); }
        .file-icon.code { background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.4)); color: var(--warning); }
        .file-icon.audio { background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.4)); color: var(--info); }
        .file-icon.video { background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(139, 92, 246, 0.4)); color: #8b5cf6; }

        .file-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--accent-primary);
        }

        /* Editor Premium */
        .editor-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            gap: 20px;
        }

        .editor-toolbar {
            background: rgba(18, 18, 26, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 18px 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .editor-info {
            display: flex;
            align-items: center;
            gap: 20px;
            flex: 1;
        }

        .editor-path {
            font-family: 'Fira Code', monospace;
            font-size: 0.95rem;
            color: var(--text-secondary);
            padding: 10px 15px;
            background: rgba(26, 26, 37, 0.7);
            border-radius: 10px;
            border: 1px solid var(--border);
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .editor-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .language-selector {
            padding: 10px 15px;
            background: rgba(26, 26, 37, 0.7);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: 'Fira Code', monospace;
            cursor: pointer;
        }

        .editor-wrapper {
            flex: 1;
            background: rgba(18, 18, 26, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            position: relative;
        }

        .line-numbers {
            width: 60px;
            background: rgba(26, 26, 37, 0.7);
            padding: 20px 15px;
            text-align: right;
            color: var(--text-secondary);
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
            line-height: 1.8;
            user-select: none;
            overflow: hidden;
            border-right: 1px solid var(--border);
        }

        .code-editor {
            flex: 1;
            padding: 20px;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-family: 'Fira Code', monospace;
            font-size: 0.95rem;
            line-height: 1.8;
            resize: none;
            outline: none;
            white-space: pre;
            overflow: auto;
            tab-size: 4;
        }

        .editor-status {
            position: absolute;
            bottom: 0;
            right: 0;
            padding: 10px 20px;
            background: rgba(26, 26, 37, 0.9);
            border-top: 1px solid var(--border);
            border-left: 1px solid var(--border);
            border-radius: 10px 0 0 0;
            font-family: 'Fira Code', monospace;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Console Premium */
        .console-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            gap: 20px;
        }

        .console-output {
            flex: 1;
            background: rgba(13, 13, 18, 0.95);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 25px;
            overflow-y: auto;
            font-family: 'Fira Code', monospace;
            font-size: 0.95rem;
            line-height: 1.8;
            position: relative;
        }

        .console-output::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--gradient-primary);
        }

        .console-line {
            margin-bottom: 8px;
            white-space: pre-wrap;
            word-break: break-word;
            padding-left: 10px;
            border-left: 3px solid transparent;
            animation: slideIn 0.3s ease-out;
        }

        .console-line.error { 
            color: var(--error);
            border-left-color: var(--error);
            background: rgba(239, 68, 68, 0.05);
        }
        .console-line.success { 
            color: var(--success);
            border-left-color: var(--success);
            background: rgba(16, 185, 129, 0.05);
        }
        .console-line.warning { 
            color: var(--warning);
            border-left-color: var(--warning);
            background: rgba(245, 158, 11, 0.05);
        }
        .console-line.info { 
            color: var(--accent-secondary);
            border-left-color: var(--accent-secondary);
            background: rgba(125, 95, 255, 0.05);
        }
        .console-line.log { 
            color: var(--text-primary);
            border-left-color: var(--accent-tertiary);
        }

        .console-input-wrapper {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .console-prompt {
            color: var(--accent-primary);
            font-weight: bold;
            font-family: 'Fira Code', monospace;
            white-space: nowrap;
        }

        .console-input {
            flex: 1;
            padding: 18px 25px;
            background: rgba(18, 18, 26, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 15px;
            color: var(--text-primary);
            font-family: 'Fira Code', monospace;
            font-size: 1rem;
            transition: var(--transition);
        }

        .console-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(255, 46, 99, 0.2);
            background: rgba(18, 18, 26, 0.95);
        }

        /* Bot Control Premium */
        .bot-control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .bot-status-card {
            background: linear-gradient(135deg, rgba(18, 18, 26, 0.9), rgba(26, 26, 37, 0.9));
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 30px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .bot-status-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--gradient-primary);
        }

        .bot-status-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-shadow);
        }

        .status-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .status-dot {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            animation: pulse 2s infinite;
            box-shadow: 0 0 20px currentColor;
        }

        .status-dot.online { 
            background: var(--success);
            color: var(--success);
        }
        .status-dot.offline { 
            background: var(--error);
            color: var(--error);
        }
        .status-dot.connecting { 
            background: var(--warning);
            color: var(--warning);
            animation: glow 2s infinite;
        }

        .status-text {
            font-weight: 700;
            font-size: 1.2rem;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
        }

        .bot-info {
            margin: 25px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid var(--border);
        }

        .bot-info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .bot-info-row:last-child {
            border-bottom: none;
        }

        .bot-info-label {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .bot-info-value {
            color: var(--text-primary);
            font-weight: 600;
            font-family: 'Fira Code', monospace;
        }

        .bot-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }

        .action-btn {
            padding: 18px 25px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: var(--transition);
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .action-btn.restart {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.4));
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .action-btn.stop {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.4));
            color: var(--error);
            border: 1px solid var(--error);
        }

        .action-btn.start {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.4));
            color: var(--success);
            border: 1px solid var(--success);
        }

        .action-btn.config {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.4));
            color: var(--info);
            border: 1px solid var(--info);
        }

        /* Logs View */
        #logsView .console-toolbar {
            margin-bottom: 20px;
        }

        /* Modal Premium */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .modal-overlay.active {
            display: flex;
            animation: slideIn 0.3s ease-out;
        }

        .modal {
            background: linear-gradient(135deg, rgba(18, 18, 26, 0.95), rgba(26, 26, 37, 0.95));
            backdrop-filter: blur(30px);
            border: 1px solid var(--border);
            border-radius: 25px;
            padding: 40px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--card-shadow);
            position: relative;
            animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
        }

        .modal-header {
            margin-bottom: 30px;
            text-align: center;
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-family: 'Orbitron', sans-serif;
        }

        .modal-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 12px;
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 16px 20px;
            background: rgba(26, 26, 37, 0.7);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: var(--transition);
            font-family: 'Inter', sans-serif;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(255, 46, 99, 0.2);
            background: rgba(26, 26, 37, 0.9);
        }

        .form-group textarea {
            min-height: 200px;
            resize: vertical;
            font-family: 'Fira Code', monospace;
            line-height: 1.6;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .btn-secondary {
            padding: 16px 30px;
            background: rgba(26, 26, 37, 0.7);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            font-family: 'Inter', sans-serif;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--text-secondary);
            transform: translateY(-2px);
        }

        .btn-primary {
            padding: 16px 30px;
            background: var(--gradient-primary);
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            font-family: 'Inter', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(255, 46, 99, 0.4);
        }

        /* Toast Premium */
        .toast-container {
            position: fixed;
            top: 25px;
            right: 25px;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .toast {
            background: linear-gradient(135deg, rgba(18, 18, 26, 0.95), rgba(26, 26, 37, 0.95));
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 20px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            min-width: 350px;
            animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }

        .toast::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
        }

        .toast.success::before { background: var(--success); }
        .toast.error::before { background: var(--error); }
        .toast.warning::before { background: var(--warning); }
        .toast.info::before { background: var(--info); }

        .toast i {
            font-size: 1.5rem;
        }

        .toast.success i { color: var(--success); }
        .toast.error i { color: var(--error); }
        .toast.warning i { color: var(--warning); }
        .toast.info i { color: var(--info); }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .toast-message {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 99;
            box-shadow: 0 8px 25px rgba(255, 46, 99, 0.4);
            transition: var(--transition);
            animation: float 4s ease-in-out infinite;
        }

        .theme-toggle:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 12px 35px rgba(255, 46, 99, 0.6);
        }

        .theme-toggle i {
            color: white;
            font-size: 1.5rem;
            transition: var(--transition);
        }

        /* Wave Animation */
        .wave-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100px;
            overflow: hidden;
            z-index: -1;
        }

        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 46, 99, 0.1), transparent);
            animation: wave 15s linear infinite;
        }

        /* Scrollbar Personalizada */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gradient-primary);
            border-radius: 5px;
            border: 2px solid var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-primary);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
            
            .bot-control-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 992px) {
            .file-manager {
                flex-direction: column;
            }
            
            .file-sidebar {
                width: 100%;
                height: auto;
                max-height: 300px;
            }
            
            .file-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -280px;
                height: 100%;
                z-index: 100;
                transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }

            .sidebar.open {
                left: 0;
                box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
            }

            .top-bar {
                padding: 0 20px;
                height: 60px;
            }

            .page-title {
                font-size: 1.2rem;
            }

            .content-area {
                padding: 15px;
            }

            .modal {
                padding: 30px 20px;
                width: 95%;
            }

            .toast {
                min-width: 280px;
            }

            .file-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                padding: 15px;
            }
            
            .bot-actions {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .login-box {
                padding: 30px 20px;
                width: 95%;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .file-toolbar {
                flex-direction: column;
                align-items: stretch;
            }

            .breadcrumb {
                order: 2;
                margin-top: 15px;
            }

            .toolbar-btn {
                width: 100%;
                justify-content: center;
            }

            .modal-actions {
                flex-direction: column;
            }

            .btn-primary,
            .btn-secondary {
                width: 100%;
                text-align: center;
            }
            
            .bot-actions {
                grid-template-columns: 1fr;
            }
            
            .theme-toggle {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
            }
        }

        /* Efectos especiales */
        .glow-effect {
            position: relative;
        }

        .glow-effect::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #ff2e63, #7d5fff, #00d4ff);
            border-radius: inherit;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .glow-effect:hover::after {
            opacity: 0.3;
        }

        /* Typing Animation */
        .typing {
            overflow: hidden;
            white-space: nowrap;
            animation: typing 2s steps(40, end);
        }

        /* Interactive Elements */
        .clickable {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><circle cx="12" cy="12" r="8" fill="%237d5fff" opacity="0.7"/></svg>') 12 12, pointer;
        }

        /* Notification Container */
        .notification-container {
            position: fixed;
            top: 25px;
            left: 25px;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .notification {
            background: linear-gradient(135deg, rgba(18, 18, 26, 0.95), rgba(26, 26, 37, 0.95));
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            animation: slideIn 0.3s ease;
            box-shadow: var(--card-shadow);
        }

        .notification-icon {
            font-size: 1.2rem;
        }

        .notification.success .notification-icon { color: var(--success); }
        .notification.error .notification-icon { color: var(--error); }
        .notification.warning .notification-icon { color: var(--warning); }
        .notification.info .notification-icon { color: var(--info); }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .notification-message {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 5px;
            transition: var(--transition);
        }

        .notification-close:hover {
            color: var(--accent-primary);
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-primary {
            background: rgba(59, 130, 246, 0.1);
            color: var(--info);
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .badge-error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }

        /* Tooltips */
        .tooltip {
            position: relative;
        }

        .tooltip::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: 6px 12px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-radius: 6px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            z-index: 1000;
            border: 1px solid var(--border);
        }

        .tooltip:hover::before {
            opacity: 1;
            visibility: visible;
            bottom: calc(100% + 8px);
        }

        /* Loaders */
        .loader {
            width: 24px;
            height: 24px;
            border: 3px solid var(--border);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loader-small {
            width: 16px;
            height: 16px;
            border-width: 2px;
        }

        /* Progress bars */
        .progress-container {
            width: 100%;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 3px;
            width: 0;
            transition: width 0.3s ease;
        }

        /* Print Styles */
        @media print {
            .no-print {
                display: none !important;
            }
        }

        /* Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
    </div>

    <!-- Login Screen -->
    <div class="login-screen active" id="loginScreen">
        <div class="wave-container">
            <div class="wave"></div>
        </div>
        <div class="login-box">
            <h1><i class="fas fa-cube"></i> AstaFile Pro</h1>
            <p>Panel de Control Premium v2.0</p>
            <form id="loginForm">
                <div class="input-group">
                    <label><i class="fas fa-user"></i> Usuario</label>
                    <input type="text" id="username" placeholder="Ingresa tu usuario" required autocomplete="username">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-lock"></i> Contrase√±a</label>
                    <input type="password" id="password" placeholder="Ingresa tu contrase√±a" required autocomplete="current-password">
                    <i class="fas fa-key"></i>
                </div>
                <button type="submit" class="btn">
                    <i class="fas fa-sign-in-alt"></i> Ingresar al Panel
                </button>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-cube"></i> AstaFile Pro</h2>
            </div>

            <nav class="nav-menu">
                <div class="nav-item active" data-view="dashboard">
                    <i class="fas fa-chart-network"></i>
                    <span>Dashboard</span>
                </div>
                <div class="nav-item" data-view="files">
                    <i class="fas fa-folder-tree"></i>
                    <span>Explorador</span>
                </div>
                <div class="nav-item" data-view="editor">
                    <i class="fas fa-code"></i>
                    <span>Editor Pro</span>
                </div>
                <div class="nav-item" data-view="console">
                    <i class="fas fa-terminal"></i>
                    <span>Consola Live</span>
                </div>
                <div class="nav-item" data-view="bot">
                    <i class="fas fa-robot"></i>
                    <span>Control Bot</span>
                </div>
                <div class="nav-item" data-view="logs">
                    <i class="fas fa-scroll"></i>
                    <span>Logs del Sistema</span>
                </div>
                <div class="nav-item" data-view="settings">
                    <i class="fas fa-cog"></i>
                    <span>Configuraci√≥n</span>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div class="user-details">
                        <div class="user-name" id="userName">Usuario</div>
                        <div class="user-role">Administrador Premium</div>
                    </div>
                </div>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="top-bar">
                <h1 class="page-title" id="pageTitle">
                    <i class="fas fa-chart-network"></i> Dashboard
                </h1>
                <div class="top-actions">
                    <button class="icon-btn" id="refreshBtn" onclick="refreshCurrentView()" title="Actualizar">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="icon-btn" onclick="toggleSidebar()" title="Men√∫">
                        <i class="fas fa-bars"></i>
                    </button>
                    <button class="icon-btn" onclick="toggleFullscreen()" title="Pantalla Completa">
                        <i class="fas fa-expand"></i>
                    </button>
                    <button class="icon-btn" onclick="showNotifications()" title="Notificaciones">
                        <i class="fas fa-bell"></i>
                        <span class="badge badge-error" id="notificationBadge" style="position: absolute; top: -5px; right: -5px; display: none;">0</span>
                    </button>
                </div>
            </header>

            <div class="content-area">
                <!-- Dashboard View -->
                <div class="view active" id="dashboardView">
                    <div class="dashboard-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-title">Memoria Usada</span>
                                <div class="stat-icon pink"><i class="fas fa-memory"></i></div>
                            </div>
                            <div class="stat-value" id="memUsed">0 MB</div>
                            <div class="stat-progress">
                                <div class="stat-progress-bar" id="memProgress"></div>
                            </div>
                            <div class="stat-subtitle">
                                <span>Heap: <span id="heapUsed">0</span> MB</span>
                                <span class="stat-trend trend-up" id="memTrend">+0%</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-title">CPU Usado</span>
                                <div class="stat-icon blue"><i class="fas fa-microchip"></i></div>
                            </div>
                            <div class="stat-value" id="cpuUsed">0%</div>
                            <div class="stat-progress">
                                <div class="stat-progress-bar" id="cpuProgress"></div>
                            </div>
                            <div class="stat-subtitle">
                                <span>Tiempo activo: <span id="uptime">0m</span></span>
                                <span class="stat-trend trend-down" id="cpuTrend">-0%</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-title">Almacenamiento</span>
                                <div class="stat-icon green"><i class="fas fa-database"></i></div>
                            </div>
                            <div class="stat-value" id="storageUsed">0 GB</div>
                            <div class="stat-progress">
                                <div class="stat-progress-bar" id="storageProgress"></div>
                            </div>
                            <div class="stat-subtitle">
                                <span id="storageInfo">0 GB / 0 GB</span>
                                <span class="stat-trend trend-up" id="storageTrend">+0%</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-title">Estado Bot</span>
                                <div class="stat-icon cyan"><i class="fas fa-robot"></i></div>
                            </div>
                            <div class="stat-value" id="botStatus">Offline</div>
                            <div class="stat-subtitle">
                                <span>SubBots: <span id="subBotsCount">0</span></span>
                                <span id="botUptime">0h 0m</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-title">Plugins Cargados</span>
                                <div class="stat-icon purple"><i class="fas fa-puzzle-piece"></i></div>
                            </div>
                            <div class="stat-value" id="pluginsCount">0</div>
                            <div class="stat-progress">
                                <div class="stat-progress-bar" id="pluginsProgress"></div>
                            </div>
                            <div class="stat-subtitle">
                                <span>Total Plugins</span>
                                <span class="stat-trend trend-up">+0</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-title">Sesiones Activas</span>
                                <div class="stat-icon orange"><i class="fas fa-users"></i></div>
                            </div>
                            <div class="stat-value" id="sessionsCount">0</div>
                            <div class="stat-progress">
                                <div class="stat-progress-bar" id="sessionsProgress"></div>
                            </div>
                            <div class="stat-subtitle">
                                <span>Chats: <span id="chatsCount">0</span></span>
                                <span class="stat-trend trend-up">+0</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-title">Rendimiento Web</span>
                                <div class="stat-icon cyan"><i class="fas fa-tachometer-alt"></i></div>
                            </div>
                            <div class="stat-value" id="webPerf">100%</div>
                            <div class="stat-progress">
                                <div class="stat-progress-bar" id="webPerfProgress"></div>
                            </div>
                            <div class="stat-subtitle">
                                <span>Latencia: <span id="latency">0ms</span></span>
                                <span class="stat-trend trend-up">+0%</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-title">Seguridad</span>
                                <div class="stat-icon green"><i class="fas fa-shield-alt"></i></div>
                            </div>
                            <div class="stat-value" id="securityStatus">100%</div>
                            <div class="stat-progress">
                                <div class="stat-progress-bar" id="securityProgress"></div>
                            </div>
                            <div class="stat-subtitle">
                                <span>Protegido</span>
                                <span class="stat-trend trend-up">‚úì</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div style="margin-top: 30px;">
                        <div class="file-toolbar">
                            <span style="font-weight: 600; color: var(--accent-secondary);">Acciones R√°pidas:</span>
                            <button class="toolbar-btn" onclick="switchView('files')">
                                <i class="fas fa-folder-plus"></i> Explorar Archivos
                            </button>
                            <button class="toolbar-btn" onclick="switchView('console')">
                                <i class="fas fa-terminal"></i> Abrir Consola
                            </button>
                            <button class="toolbar-btn" onclick="loadBotStatus(); switchView('bot')">
                                <i class="fas fa-robot"></i> Ver Estado Bot
                            </button>
                            <button class="toolbar-btn" onclick="showQuickStats()">
                                <i class="fas fa-chart-bar"></i> Estad√≠sticas
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Files View -->
                <div class="view" id="filesView">
                    <div class="file-manager">
                        <div class="file-sidebar">
                            <div class="file-tree-item active" onclick="navigateTo('.')">
                                <i class="fas fa-home"></i> Inicio
                            </div>
                            <div class="file-tree-item" onclick="navigateTo('./plugins')">
                                <i class="fas fa-puzzle-piece"></i> Plugins
                                <span class="badge badge-primary" id="pluginsBadge">0</span>
                            </div>
                            <div class="file-tree-item" onclick="navigateTo('./lib')">
                                <i class="fas fa-book"></i> Librer√≠as
                            </div>
                            <div class="file-tree-item" onclick="navigateTo('./Sessions')">
                                <i class="fas fa-database"></i> Sesiones
                            </div>
                            <div class="file-tree-item" onclick="navigateTo('./tmp')">
                                <i class="fas fa-trash"></i> Temporal
                            </div>
                            <div class="file-tree-item" onclick="navigateTo('./public')">
                                <i class="fas fa-globe"></i> Web Public
                            </div>
                            <div class="file-tree-item" onclick="navigateTo('./config')">
                                <i class="fas fa-cog"></i> Configuraci√≥n
                            </div>
                            <div class="file-tree-item" onclick="navigateTo('./logs')">
                                <i class="fas fa-scroll"></i> Logs
                            </div>
                            <div class="file-tree-item" onclick="navigateTo('./backups')">
                                <i class="fas fa-hdd"></i> Backups
                            </div>
                            <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 10px;">Espacio Usado:</div>
                                <div class="progress-container">
                                    <div class="progress-bar" id="sidebarStorageProgress"></div>
                                </div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 5px;" id="sidebarStorageText">0 GB / 0 GB</div>
                            </div>
                        </div>

                        <div class="file-main">
                            <div class="file-toolbar">
                                <div class="breadcrumb" id="breadcrumb">
                                    <span class="breadcrumb-item" onclick="navigateTo('.')">Inicio</span>
                                </div>
                                <div class="file-view-toggle">
                                    <button class="view-btn active" onclick="setFileView('grid')" title="Vista de Cuadr√≠cula">
                                        <i class="fas fa-th-large"></i>
                                    </button>
                                    <button class="view-btn" onclick="setFileView('list')" title="Vista de Lista">
                                        <i class="fas fa-list"></i>
                                    </button>
                                    <button class="view-btn" onclick="setFileView('icons')" title="Vista de √çconos">
                                        <i class="fas fa-th"></i>
                                    </button>
                                </div>
                                <button class="toolbar-btn" onclick="showCreateModal()">
                                    <i class="fas fa-file-plus"></i> Nuevo Archivo
                                </button>
                                <button class="toolbar-btn" onclick="showCreateFolderModal()">
                                    <i class="fas fa-folder-plus"></i> Nueva Carpeta
                                </button>
                                <button class="toolbar-btn" onclick="showUploadModal()">
                                    <i class="fas fa-cloud-upload-alt"></i> Subir
                                </button>
                                <button class="toolbar-btn danger" onclick="deleteSelected()">
                                    <i class="fas fa-trash-alt"></i> Eliminar
                                </button>
                                <button class="toolbar-btn" onclick="refreshFiles()" title="Actualizar">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>

                            <div class="file-list" id="fileListContainer">
                                <!-- Vista de cuadr√≠cula por defecto -->
                                <div class="file-grid" id="fileGridView">
                                    <!-- Archivos cargados din√°micamente -->
                                </div>
                                
                                <!-- Vista de tabla (oculta por defecto) -->
                                <table class="file-table" id="fileTableView" style="display: none;">
                                    <thead>
                                        <tr>
                                            <th style="width: 40px;"><input type="checkbox" id="selectAll"></th>
                                            <th>Nombre</th>
                                            <th>Tama√±o</th>
                                            <th>Tipo</th>
                                            <th>Modificado</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="fileListBody">
                                        <!-- Archivos cargados din√°micamente -->
                                    </tbody>
                                </table>
                                
                                <!-- Vista de √≠conos (oculta por defecto) -->
                                <div class="file-grid" id="fileIconsView" style="display: none; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));">
                                    <!-- Archivos cargados din√°micamente -->
                                </div>
                            </div>
                            
                            <!-- Informaci√≥n de archivos seleccionados -->
                            <div id="selectionInfo" style="display: none; margin-top: 15px; padding: 15px; background: rgba(255,46,99,0.1); border-radius: 10px; border: 1px solid rgba(255,46,99,0.3);">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <span style="font-weight: 600; color: var(--accent-primary);" id="selectedCount">0</span> archivo(s) seleccionado(s)
                                        <span style="color: var(--text-secondary); margin-left: 10px;" id="selectedSize">0 B</span>
                                    </div>
                                    <button class="toolbar-btn danger" onclick="clearSelection()" style="padding: 8px 15px;">
                                        <i class="fas fa-times"></i> Deseleccionar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Editor View -->
                <div class="view" id="editorView">
                    <div class="editor-container">
                        <div class="editor-toolbar">
                            <div class="editor-info">
                                <span class="editor-path" id="editorPath">Sin archivo abierto</span>
                                <select class="language-selector" id="languageSelector" onchange="changeEditorLanguage()">
                                    <option value="auto">Auto-detectar</option>
                                    <option value="javascript">JavaScript</option>
                                    <option value="html">HTML</option>
                                    <option value="css">CSS</option>
                                    <option value="python">Python</option>
                                    <option value="json">JSON</option>
                                    <option value="markdown">Markdown</option>
                                    <option value="bash">Bash</option>
                                    <option value="php">PHP</option>
                                    <option value="java">Java</option>
                                    <option value="cpp">C++</option>
                                    <option value="xml">XML</option>
                                    <option value="yaml">YAML</option>
                                </select>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="font-size: 0.85rem; color: var(--text-secondary);" id="fileSize">0 B</span>
                                    <span style="font-size: 0.85rem; color: var(--text-secondary);" id="fileLines">0 l√≠neas</span>
                                </div>
                            </div>
                            <div class="editor-actions">
                                <button class="toolbar-btn" onclick="saveFile()" id="saveBtn">
                                    <i class="fas fa-save"></i> Guardar
                                </button>
                                <button class="toolbar-btn" onclick="downloadFile()">
                                    <i class="fas fa-download"></i> Descargar
                                </button>
                                <button class="toolbar-btn" onclick="formatCode()">
                                    <i class="fas fa-broom"></i> Formatear
                                </button>
                                <button class="toolbar-btn" onclick="findInFile()">
                                    <i class="fas fa-search"></i> Buscar
                                </button>
                                <button class="toolbar-btn" onclick="closeEditor()">
                                    <i class="fas fa-times"></i> Cerrar
                                </button>
                            </div>
                        </div>
                        <div class="editor-wrapper">
                            <div class="line-numbers" id="lineNumbers">1</div>
                            <textarea class="code-editor" id="codeEditor" spellcheck="false" 
                                      placeholder="Escribe tu c√≥digo aqu√≠... Presiona Ctrl+S para guardar"></textarea>
                            <div class="editor-status">
                                <span id="editorStatus">Sin cambios</span>
                                <span> | L√≠nea: <span id="currentLine">1</span>, Columna: <span id="currentColumn">1</span></span>
                                <span> | Codificaci√≥n: UTF-8</span>
                                <span> | <span id="wordCount">0</span> palabras</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Console View -->
                <div class="view" id="consoleView">
                    <div class="console-container">
                        <div class="console-toolbar" style="margin-bottom: 20px;">
                            <button class="toolbar-btn" onclick="clearConsole()">
                                <i class="fas fa-eraser"></i> Limpiar
                            </button>
                            <button class="toolbar-btn" onclick="startInteractiveShell()" id="shellBtn">
                                <i class="fas fa-terminal"></i> Shell Interactivo
                            </button>
                            <button class="toolbar-btn" onclick="toggleAutoScroll()">
                                <i class="fas fa-scroll" id="autoScrollIcon"></i> Auto-scroll
                            </button>
                            <button class="toolbar-btn" onclick="exportConsoleLogs()">
                                <i class="fas fa-file-export"></i> Exportar Logs
                            </button>
                            <button class="toolbar-btn" onclick="showCommandHistory()">
                                <i class="fas fa-history"></i> Historial
                            </button>
                            <button class="toolbar-btn" onclick="runQuickCommand('status')">
                                <i class="fas fa-info-circle"></i> Status
                            </button>
                            <button class="toolbar-btn" onclick="runQuickCommand('help')">
                                <i class="fas fa-question-circle"></i> Ayuda
                            </button>
                        </div>
                        <div class="console-output" id="consoleOutput">
                            <div class="console-line info">
                                <i class="fas fa-info-circle"></i> Consola AstaFile Pro v2.0 iniciada.
                            </div>
                            <div class="console-line info">
                                <i class="fas fa-info-circle"></i> Escribe comandos para interactuar con el sistema.
                            </div>
                            <div class="console-line info">
                                <i class="fas fa-info-circle"></i> Usa las flechas ‚Üë‚Üì para navegar en el historial.
                            </div>
                        </div>
                        <div class="console-input-wrapper">
                            <span class="console-prompt" id="consolePrompt">$</span>
                            <input type="text" class="console-input" id="consoleInput" 
                                   placeholder="Escribe un comando y presiona Enter..." 
                                   onkeypress="handleConsoleKeypress(event)"
                                   autocomplete="off">
                            <button class="btn" onclick="executeCommand()" style="width: auto; padding: 18px 35px;">
                                <i class="fas fa-play"></i> Ejecutar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Bot Control View -->
                <div class="view" id="botView">
                    <div class="bot-control-grid">
                        <div class="bot-status-card">
                            <div class="status-header">
                                <div class="status-indicator">
                                    <div class="status-dot offline" id="statusDot"></div>
                                    <span class="status-text" id="statusText">Desconectado</span>
                                </div>
                                <span id="botNumber">#0000</span>
                            </div>
                            
                            <div class="bot-info">
                                <div class="bot-info-row">
                                    <span class="bot-info-label">Usuario:</span>
                                    <span class="bot-info-value" id="botUserName">-</span>
                                </div>
                                <div class="bot-info-row">
                                    <span class="bot-info-label">ID del Bot:</span>
                                    <span class="bot-info-value" id="botId">-</span>
                                </div>
                                <div class="bot-info-row">
                                    <span class="bot-info-label">Tiempo Activo:</span>
                                    <span class="bot-info-value" id="botUptimeDetail">0h 0m 0s</span>
                                </div>
                                <div class="bot-info-row">
                                    <span class="bot-info-label">Sub-Bots Activos:</span>
                                    <span class="bot-info-value" id="activeSubBots">0</span>
                                </div>
                                <div class="bot-info-row">
                                    <span class="bot-info-label">Plugins Activos:</span>
                                    <span class="bot-info-value" id="activePlugins">0</span>
                                </div>
                                <div class="bot-info-row">
                                    <span class="bot-info-label">√öltima Conexi√≥n:</span>
                                    <span class="bot-info-value" id="lastConnection">-</span>
                                </div>
                            </div>
                            
                            <div class="bot-actions">
                                <button class="action-btn start" onclick="startBot()" id="startBtn">
                                    <i class="fas fa-play"></i> Iniciar
                                </button>
                                <button class="action-btn restart" onclick="restartBot()" id="restartBtn">
                                    <i class="fas fa-redo"></i> Reiniciar
                                </button>
                                <button class="action-btn stop" onclick="stopBot()" id="stopBtn">
                                    <i class="fas fa-power-off"></i> Apagar
                                </button>
                                <button class="action-btn config" onclick="showBotConfig()">
                                    <i class="fas fa-cog"></i> Configurar
                                </button>
                            </div>
                        </div>
                        
                        <div class="bot-status-card">
                            <div class="status-header">
                                <div class="status-indicator">
                                    <i class="fas fa-chart-bar"></i>
                                    <span class="status-text">Estad√≠sticas en Tiempo Real</span>
                                </div>
                                <button class="icon-btn" onclick="updateBotStats()" title="Actualizar stats" style="width: 35px; height: 35px;">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                            
                            <div class="bot-info">
                                <div class="bot-info-row">
                                    <span class="bot-info-label">Mensajes Procesados:</span>
                                    <span class="bot-info-value" id="processedMessages">0</span>
                                </div>
                                <div class="bot-info-row">
                                    <span class="bot-info-label">Comandos Ejecutados:</span>
                                    <span class="bot-info-value" id="executedCommands">0</span>
                                </div>
                                <div class="bot-info-row">
                                    <span class="bot-info-label">Usuarios √önicos:</span>
                                    <span class="bot-info-value" id="uniqueUsers">0</span>
                                </div>
                                <div class="bot-info-row">
                                    <span class="bot-info-label">Grupos Activos:</span>
                                    <span class="bot-info-value" id="activeGroups">0</span>
                                </div>
                                <div class="bot-info-row">
                                    <span class="bot-info-label">Tasa de Respuesta:</span>
                                    <span class="bot-info-value" id="responseRate">0%</span>
                                </div>
                                <div class="bot-info-row">
                                    <span class="bot-info-label">Uptime del Sistema:</span>
                                    <span class="bot-info-value" id="systemUptime">0d 0h 0m</span>
                                </div>
                            </div>
                            
                            <div class="bot-actions">
                                <button class="action-btn" onclick="clearBotStats()" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(139, 92, 246, 0.4)); color: #8b5cf6; border: 1px solid #8b5cf6;">
                                    <i class="fas fa-trash-alt"></i> Limpiar Stats
                                </button>
                                <button class="action-btn" onclick="exportBotStats()" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.4)); color: var(--success); border: 1px solid var(--success);">
                                    <i class="fas fa-file-export"></i> Exportar Stats
                                </button>
                                <button class="action-btn" onclick="showDetailedStats()" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.4)); color: var(--info); border: 1px solid var(--info);">
                                    <i class="fas fa-chart-line"></i> Gr√°ficos
                                </button>
                            </div>
                        </div>
                        
                        <!-- Quick Commands -->
                        <div class="bot-status-card">
                            <div class="status-header">
                                <div class="status-indicator">
                                    <i class="fas fa-bolt"></i>
                                    <span class="status-text">Comandos R√°pidos</span>
                                </div>
                            </div>
                            
                            <div class="bot-info">
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                                    <button class="toolbar-btn" onclick="sendBotCommand('ping')" style="justify-content: center;">
                                        <i class="fas fa-satellite"></i> Ping
                                    </button>
                                    <button class="toolbar-btn" onclick="sendBotCommand('status')" style="justify-content: center;">
                                        <i class="fas fa-info-circle"></i> Estado
                                    </button>
                                    <button class="toolbar-btn" onclick="sendBotCommand('reload')" style="justify-content: center;">
                                        <i class="fas fa-sync-alt"></i> Recargar
                                    </button>
                                    <button class="toolbar-btn" onclick="sendBotCommand('broadcast')" style="justify-content: center;">
                                        <i class="fas fa-bullhorn"></i> Broadcast
                                    </button>
                                    <button class="toolbar-btn" onclick="sendBotCommand('backup')" style="justify-content: center;">
                                        <i class="fas fa-save"></i> Backup
                                    </button>
                                    <button class="toolbar-btn" onclick="sendBotCommand('update')" style="justify-content: center;">
                                        <i class="fas fa-download"></i> Actualizar
                                    </button>
                                </div>
                            </div>
                            
                            <div class="bot-actions">
                                <button class="action-btn" onclick="showCustomCommandModal()" style="background: linear-gradient(135deg, rgba(255, 46, 99, 0.2), rgba(255, 46, 99, 0.4)); color: var(--accent-primary); border: 1px solid var(--accent-primary); grid-column: span 2;">
                                    <i class="fas fa-terminal"></i> Comando Personalizado
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Logs View -->
                <div class="view" id="logsView">
                    <div class="console-container">
                        <div class="console-toolbar" style="margin-bottom: 20px;">
                            <button class="toolbar-btn" onclick="clearSystemLogs()">
                                <i class="fas fa-eraser"></i> Limpiar Logs
                            </button>
                            <button class="toolbar-btn" onclick="toggleLogsAutoRefresh()" id="logsRefreshBtn">
                                <i class="fas fa-sync-alt" id="logsRefreshIcon"></i> Auto-refresh
                            </button>
                            <button class="toolbar-btn" onclick="exportSystemLogs()">
                                <i class="fas fa-file-export"></i> Exportar Logs
                            </button>
                            <select class="language-selector" id="logLevelFilter" onchange="filterLogs()" style="width: 150px;">
                                <option value="all">Todos los niveles</option>
                                <option value="error">Solo Errores</option>
                                <option value="warning">Solo Advertencias</option>
                                <option value="info">Solo Info</option>
                                <option value="log">Solo Logs</option>
                                <option value="debug">Solo Debug</option>
                            </select>
                            <input type="text" class="console-input" id="logSearch" placeholder="Buscar en logs..." style="width: 200px; padding: 10px 15px;" onkeyup="searchLogs()">
                            <button class="toolbar-btn" onclick="showLogSettings()">
                                <i class="fas fa-cog"></i> Configuraci√≥n
                            </button>
                        </div>
                        <div class="console-output" id="systemLogsOutput">
                            <div class="console-line info">
                                <i class="fas fa-info-circle"></i> Cargando logs del sistema...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings View -->
                <div class="view" id="settingsView">
                    <div class="bot-control-grid">
                        <div class="bot-status-card">
                            <div class="status-header">
                                <div class="status-indicator">
                                    <i class="fas fa-user-cog"></i>
                                    <span class="status-text">Configuraci√≥n de Usuario</span>
                                </div>
                            </div>
                            
                            <div class="bot-info">
                                <div class="form-group">
                                    <label>Tema de la Interfaz</label>
                                    <select id="themeSelect" onchange="changeTheme(this.value)" class="language-selector">
                                        <option value="dark">Oscuro</option>
                                        <option value="light">Claro</option>
                                        <option value="auto">Auto (Sistema)</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label>Idioma</label>
                                    <select id="languageSelect" class="language-selector">
                                        <option value="es">Espa√±ol</option>
                                        <option value="en">English</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label>Notificaciones</label>
                                    <div style="display: flex; flex-direction: column; gap: 10px;">
                                        <label style="display: flex; align-items: center; gap: 10px;">
                                            <input type="checkbox" id="notifySuccess" checked> √âxito
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 10px;">
                                            <input type="checkbox" id="notifyError" checked> Errores
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 10px;">
                                            <input type="checkbox" id="notifyWarning" checked> Advertencias
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 10px;">
                                            <input type="checkbox" id="notifyInfo"> Informaci√≥n
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Auto-guardado (Editor)</label>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <input type="checkbox" id="autoSave" checked>
                                        <span>Activar auto-guardado cada</span>
                                        <select id="autoSaveInterval" style="width: 100px;">
                                            <option value="30000">30 segundos</option>
                                            <option value="60000">1 minuto</option>
                                            <option value="300000">5 minutos</option>
                                            <option value="600000">10 minutos</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bot-actions">
                                <button class="action-btn" onclick="saveUserSettings()" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.4)); color: var(--success); border: 1px solid var(--success);">
                                    <i class="fas fa-save"></i> Guardar Configuraci√≥n
                                </button>
                                <button class="action-btn" onclick="resetUserSettings()" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.4)); color: var(--warning); border: 1px solid var(--warning);">
                                    <i class="fas fa-undo"></i> Restablecer
                                </button>
                            </div>
                        </div>
                        
                        <div class="bot-status-card">
                            <div class="status-header">
                                <div class="status-indicator">
                                    <i class="fas fa-shield-alt"></i>
                                    <span class="status-text">Seguridad</span>
                                </div>
                            </div>
                            
                            <div class="bot-info">
                                <div class="form-group">
                                    <label>Cambiar Contrase√±a</label>
                                    <div style="display: flex; flex-direction: column; gap: 10px;">
                                        <input type="password" id="currentPassword" placeholder="Contrase√±a actual" class="console-input">
                                        <input type="password" id="newPassword" placeholder="Nueva contrase√±a" class="console-input">
                                        <input type="password" id="confirmPassword" placeholder="Confirmar nueva contrase√±a" class="console-input">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Sesi√≥n Activa</label>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span id="sessionTime">0 minutos</span>
                                        <button class="toolbar-btn" onclick="refreshSession()" style="padding: 8px 15px;">
                                            <i class="fas fa-sync-alt"></i> Refrescar
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Registro de Actividad</label>
                                    <button class="toolbar-btn" onclick="showActivityLog()" style="width: 100%; justify-content: center;">
                                        <i class="fas fa-history"></i> Ver Registro
                                    </button>
                                </div>
                                
                                <div class="form-group">
                                    <label>Cerrar Otras Sesiones</label>
                                    <button class="toolbar-btn danger" onclick="closeOtherSessions()" style="width: 100%; justify-content: center;">
                                        <i class="fas fa-sign-out-alt"></i> Cerrar Otras Sesiones
                                    </button>
                                </div>
                            </div>
                            
                            <div class="bot-actions">
                                <button class="action-btn" onclick="changePassword()" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.4)); color: var(--info); border: 1px solid var(--info);">
                                    <i class="fas fa-key"></i> Cambiar Contrase√±a
                                </button>
                            </div>
                        </div>
                        
                        <div class="bot-status-card">
                            <div class="status-header">
                                <div class="status-indicator">
                                    <i class="fas fa-tools"></i>
                                    <span class="status-text">Herramientas del Sistema</span>
                                </div>
                            </div>
                            
                            <div class="bot-info">
                                <div class="form-group">
                                    <label>Limpieza del Sistema</label>
                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                                        <button class="toolbar-btn" onclick="cleanTempFiles()">
                                            <i class="fas fa-trash"></i> Limpiar Temp
                                        </button>
                                        <button class="toolbar-btn" onclick="cleanLogs()">
                                            <i class="fas fa-scroll"></i> Limpiar Logs
                                        </button>
                                        <button class="toolbar-btn" onclick="clearCache()">
                                            <i class="fas fa-broom"></i> Limpiar Cache
                                        </button>
                                        <button class="toolbar-btn" onclick="optimizeDatabase()">
                                            <i class="fas fa-database"></i> Optimizar DB
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Backup del Sistema</label>
                                    <div style="display: flex; flex-direction: column; gap: 10px;">
                                        <button class="toolbar-btn" onclick="createBackup()">
                                            <i class="fas fa-save"></i> Crear Backup
                                        </button>
                                        <button class="toolbar-btn" onclick="restoreBackup()">
                                            <i class="fas fa-upload"></i> Restaurar Backup
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Diagn√≥stico</label>
                                    <button class="toolbar-btn" onclick="runDiagnostic()" style="width: 100%; justify-content: center;">
                                        <i class="fas fa-stethoscope"></i> Ejecutar Diagn√≥stico
                                    </button>
                                </div>
                                
                                <div class="form-group">
                                    <label>Informaci√≥n del Sistema</label>
                                    <button class="toolbar-btn" onclick="showSystemInfo()" style="width: 100%; justify-content: center;">
                                        <i class="fas fa-info-circle"></i> Ver Informaci√≥n
                                    </button>
                                </div>
                            </div>
                            
                            <div class="bot-actions">
                                <button class="action-btn" onclick="exportAllSettings()" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(139, 92, 246, 0.4)); color: #8b5cf6; border: 1px solid #8b5cf6;">
                                    <i class="fas fa-file-export"></i> Exportar Config
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal" id="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">T√≠tulo</h3>
                <p class="modal-subtitle" id="modalSubtitle">Subt√≠tulo</p>
            </div>
            <div id="modalContent"></div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- Theme Toggle -->
    <div class="theme-toggle" onclick="toggleTheme()">
        <i class="fas fa-moon" id="themeIcon"></i>
    </div>

    <script>
        // ============================================
        // VARIABLES GLOBALES Y CONFIGURACI√ìN
        // ============================================
        
        let authToken = localStorage.getItem('astafile_token');
        let currentUser = null;
        let currentPath = '.';
        let currentFile = null;
        let selectedFiles = new Set();
        let socket = null;
        let shellMode = false;
        let fileViewMode = 'grid';
        let autoScroll = true;
        let logsAutoRefresh = true;
        let logsInterval = null;
        let autoSaveInterval = null;
        let commandHistory = [];
        let historyIndex = -1;
        let systemStats = {
            messages: 0,
            commands: 0,
            users: new Set(),
            groups: new Set(),
            startTime: Date.now()
        };
        let notifications = [];
        let userSettings = {
            theme: localStorage.getItem('astafile_theme') || 'dark',
            language: 'es',
            notifications: {
                success: true,
                error: true,
                warning: true,
                info: false
            },
            editor: {
                autoSave: true,
                autoSaveInterval: 30000,
                fontSize: 14,
                tabSize: 4,
                wordWrap: false
            },
            console: {
                historySize: 100,
                prompt: '$',
                showTimestamp: true
            }
        };

        // ============================================
        // INICIALIZACI√ìN
        // ============================================
        
        document.addEventListener('DOMContentLoaded', () => {
            hideLoading();
            
            // Cargar configuraciones del usuario
            loadUserSettings();
            
            // Verificar sesi√≥n existente
            if (authToken) {
                checkSession();
            }

            // Configurar formulario de login
            document.getElementById('loginForm').addEventListener('submit', handleLogin);

            // Configurar navegaci√≥n
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => switchView(item.dataset.view));
            });

            // Configurar checkbox "seleccionar todo"
            document.getElementById('selectAll').addEventListener('change', toggleSelectAll);

            // Editor mejorado
            const editor = document.getElementById('codeEditor');
            editor.addEventListener('input', updateEditorStatus);
            editor.addEventListener('scroll', syncScroll);
            editor.addEventListener('keyup', updateCursorPosition);
            editor.addEventListener('keydown', handleEditorShortcuts);

            // Consola mejorada
            const consoleInput = document.getElementById('consoleInput');
            consoleInput.addEventListener('keyup', handleConsoleNavigation);
            
            // Configurar atajos de teclado globales
            setupKeyboardShortcuts();
            
            // Inicializar tema
            applyTheme(userSettings.theme);
            
            // Configurar auto-guardado si est√° activado
            if (userSettings.editor.autoSave) {
                setupAutoSave();
            }
            
            // Mostrar informaci√≥n de carga
            console.log('üöÄ AstaFile Pro v2.0 inicializado');
        });

        // ============================================
        // FUNCIONES DE INTERFAZ DE USUARIO
        // ============================================
        
        function showLoading() {
            document.getElementById('loadingSpinner').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingSpinner').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('loadingSpinner').style.display = 'none';
            }, 500);
        }

        function showToast(message, type = 'info', duration = 3000) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };

            toast.innerHTML = `
                <i class="fas ${icons[type]}"></i>
                <div class="toast-content">
                    <div class="toast-title">${type.charAt(0).toUpperCase() + type.slice(1)}</div>
                    <div class="toast-message">${message}</div>
                </div>
            `;

            container.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s reverse';
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }

        function showNotification(title, message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };

            notification.innerHTML = `
                <div class="notification-icon">
                    <i class="fas ${icons[type]}"></i>
                </div>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <button class="notification-close" onclick="this.parentElement.remove(); updateNotificationBadge();">
                    <i class="fas fa-times"></i>
                </button>
            `;

            container.appendChild(notification);
            notifications.push({ title, message, type, time: new Date() });
            updateNotificationBadge();
            
            // Auto-remover despu√©s de 10 segundos
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                    updateNotificationBadge();
                }
            }, 10000);
        }

        function updateNotificationBadge() {
            const badge = document.getElementById('notificationBadge');
            const count = document.querySelectorAll('.notification').length;
            badge.textContent = count;
            badge.style.display = count > 0 ? 'block' : 'none';
        }

        function showNotifications() {
            if (notifications.length === 0) {
                showToast('No hay notificaciones', 'info');
                return;
            }
            
            const content = `
                <div style="max-height: 400px; overflow-y: auto;">
                    ${notifications.map((note, i) => `
                        <div style="padding: 15px; margin-bottom: 10px; background: rgba(255,255,255,0.05); border-radius: 10px; border-left: 4px solid var(--${note.type});">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <strong style="color: var(--${note.type});">${note.title}</strong>
                                <small style="color: var(--text-secondary);">${formatTimeAgo(note.time)}</small>
                            </div>
                            <div style="color: var(--text-primary);">${note.message}</div>
                        </div>
                    `).join('')}
                </div>
                <div class="modal-actions">
                    <button class="btn-secondary" onclick="closeModal()">Cerrar</button>
                    <button class="btn-primary" onclick="clearAllNotifications(); closeModal();">Limpiar Todas</button>
                </div>
            `;
            
            showModal('Notificaciones', `Tienes ${notifications.length} notificaci√≥n(es)`, content);
        }

        function clearAllNotifications() {
            document.getElementById('notificationContainer').innerHTML = '';
            notifications = [];
            updateNotificationBadge();
        }

        // ============================================
        // AUTENTICACI√ìN Y SESI√ìN
        // ============================================
        
        async function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            showLoading();
            
            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (data.success) {
                    authToken = data.token;
                    currentUser = data.username;
                    localStorage.setItem('astafile_token', authToken);
                    localStorage.setItem('astafile_user', currentUser);
                    localStorage.setItem('astafile_last_login', new Date().toISOString());
                    
                    // Registrar actividad
                    logUserActivity('login', 'Inicio de sesi√≥n exitoso');
                    
                    showToast(`¬°Bienvenido, ${currentUser}!`, 'success');
                    setTimeout(() => showApp(), 1000);
                } else {
                    showToast(data.error || 'Error de autenticaci√≥n', 'error');
                    hideLoading();
                }
            } catch (error) {
                showToast('Error de conexi√≥n con el servidor', 'error');
                hideLoading();
            }
        }

        async function checkSession() {
            try {
                const response = await fetch('/api/check-session', {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const data = await response.json();

                if (data.success) {
                    currentUser = localStorage.getItem('astafile_user');
                    showApp();
                } else {
                    logout();
                }
            } catch (error) {
                logout();
            }
        }

        function showApp() {
            document.getElementById('loginScreen').classList.remove('active');
            setTimeout(() => {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('appContainer').classList.add('active');
                
                // Actualizar informaci√≥n de usuario
                document.getElementById('userName').textContent = currentUser;
                document.getElementById('userAvatar').textContent = currentUser.charAt(0).toUpperCase();
                
                // Inicializar componentes
                initSocket();
                loadDashboard();
                loadFiles();
                startLogsAutoRefresh();
                
                // Iniciar monitoreo del sistema
                startSystemMonitoring();
                
                hideLoading();
                
                // Mostrar notificaci√≥n de bienvenida
                showNotification('Sesi√≥n Iniciada', `Bienvenido ${currentUser} al panel de control AstaFile Pro`, 'success');
            }, 500);
        }

        function logout() {
            // Registrar actividad
            logUserActivity('logout', 'Cierre de sesi√≥n');
            
            fetch('/api/logout', {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${authToken}` }
            }).catch(() => {});

            // Limpiar localStorage
            localStorage.removeItem('astafile_token');
            localStorage.removeItem('astafile_user');
            localStorage.removeItem('astafile_last_login');
            
            authToken = null;
            currentUser = null;

            // Cerrar socket
            if (socket) {
                socket.disconnect();
                socket = null;
            }
            
            // Detener intervalos
            if (logsInterval) clearInterval(logsInterval);
            if (autoSaveInterval) clearInterval(autoSaveInterval);

            // Mostrar login
            document.getElementById('appContainer').classList.remove('active');
            document.getElementById('loginScreen').style.display = 'flex';
            setTimeout(() => {
                document.getElementById('loginScreen').classList.add('active');
            }, 50);
            
            showToast('Sesi√≥n cerrada exitosamente', 'info');
        }

        function refreshSession() {
            // Simular refresco de sesi√≥n
            localStorage.setItem('astafile_last_login', new Date().toISOString());
            showToast('Sesi√≥n refrescada', 'success');
        }

        function closeOtherSessions() {
            if (confirm('¬øCerrar todas las dem√°s sesiones activas?')) {
                showToast('Otras sesiones cerradas', 'info');
            }
        }

        // ============================================
        // SOCKET.IO Y COMUNICACI√ìN EN TIEMPO REAL
        // ============================================
        
        function initSocket() {
            socket = io({
                reconnection: true,
                reconnectionAttempts: 5,
                reconnectionDelay: 1000,
                timeout: 20000
            });

            socket.on('connect', () => {
                console.log('üîå Conectado al servidor WebSocket');
                socket.emit('auth', authToken);
                showToast('Conectado al servidor en tiempo real', 'success');
                updateConnectionStatus(true);
            });

            socket.on('ready', () => {
                console.log('‚úÖ WebSocket listo para comandos');
            });

            socket.on('output', (data) => {
                appendToConsole(data.data, data.type);
            });

            socket.on('log', (data) => {
                appendToSystemLogs(data.message, data.type);
            });

            socket.on('stats', (data) => {
                updateSystemStats(data);
            });

            socket.on('done', () => {
                appendToConsole('‚úÖ Comando completado exitosamente', 'success');
            });

            socket.on('closed', () => {
                shellMode = false;
                document.getElementById('shellBtn').innerHTML = '<i class="fas fa-terminal"></i> Shell Interactivo';
                appendToConsole('‚ö†Ô∏è Shell interactivo cerrado', 'warning');
            });

            socket.on('error', (msg) => {
                showToast(`Error: ${msg}`, 'error');
            });

            socket.on('disconnect', () => {
                updateConnectionStatus(false);
                showToast('Desconectado del servidor. Reconectando...', 'warning');
            });

            socket.on('reconnect', () => {
                updateConnectionStatus(true);
                showToast('Reconectado al servidor', 'success');
            });

            socket.on('file_update', (data) => {
                handleFileUpdate(data);
            });

            socket.on('bot_status', (data) => {
                updateBotStatus(data);
            });
        }

        function updateConnectionStatus(connected) {
            const status = document.getElementById('connectionStatus') || (() => {
                const el = document.createElement('div');
                el.id = 'connectionStatus';
                el.style.position = 'fixed';
                el.style.bottom = '10px';
                el.style.left = '10px';
                el.style.padding = '5px 10px';
                el.style.borderRadius = '5px';
                el.style.fontSize = '0.8rem';
                el.style.zIndex = '1000';
                document.body.appendChild(el);
                return el;
            })();
            
            status.textContent = connected ? 'üü¢ Conectado' : 'üî¥ Desconectado';
            status.style.background = connected ? 'rgba(16, 185, 129, 0.2)' : 'rgba(239, 68, 68, 0.2)';
            status.style.color = connected ? 'var(--success)' : 'var(--error)';
            status.style.border = `1px solid ${connected ? 'var(--success)' : 'var(--error)'}`;
        }

        // ============================================
        // NAVEGACI√ìN Y VISTAS
        // ============================================
        
        function switchView(view) {
            // Actualizar navegaci√≥n
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.view === view);
            });

            // Ocultar todas las vistas
            document.querySelectorAll('.view').forEach(v => {
                v.classList.remove('active');
            });

            // Mostrar vista activa
            const activeView = document.getElementById(view + 'View');
            if (activeView) {
                activeView.classList.add('active');
            }

            // Actualizar t√≠tulo
            const titles = {
                dashboard: 'Dashboard',
                files: 'Explorador de Archivos',
                editor: 'Editor de C√≥digo Pro',
                console: 'Consola en Tiempo Real',
                bot: 'Control del Bot',
                logs: 'Logs del Sistema',
                settings: 'Configuraci√≥n'
            };

            document.getElementById('pageTitle').innerHTML = `<i class="fas fa-${getViewIcon(view)}"></i> ${titles[view] || view}`;

            // Cargar datos espec√≠ficos de la vista
            switch(view) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'files':
                    loadFiles();
                    break;
                case 'bot':
                    loadBotStatus();
                    break;
                case 'logs':
                    loadSystemLogs();
                    break;
                case 'settings':
                    loadSettings();
                    break;
            }
        }

        function getViewIcon(view) {
            const icons = {
                dashboard: 'chart-network',
                files: 'folder-tree',
                editor: 'code',
                console: 'terminal',
                bot: 'robot',
                logs: 'scroll',
                settings: 'cog'
            };
            return icons[view] || 'cube';
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    showToast(`Error al entrar en pantalla completa: ${err.message}`, 'error');
                });
            } else {
                document.exitFullscreen();
            }
        }

        function refreshCurrentView() {
            const activeView = document.querySelector('.view.active').id;
            const refreshBtn = document.getElementById('refreshBtn');
            
            // Animaci√≥n de refresco
            refreshBtn.classList.add('refreshing');
            setTimeout(() => refreshBtn.classList.remove('refreshing'), 1000);
            
            switch(activeView) {
                case 'dashboardView':
                    loadDashboard();
                    break;
                case 'filesView':
                    loadFiles();
                    break;
                case 'botView':
                    loadBotStatus();
                    break;
                case 'logsView':
                    loadSystemLogs();
                    break;
                default:
                    showToast('Vista actualizada', 'info');
            }
        }

        // ============================================
        // DASHBOARD Y MONITOREO DEL SISTEMA
        // ============================================
        
        async function loadDashboard() {
            try {
                const [statsRes, botRes, sysRes, storageRes] = await Promise.all([
                    fetch('/api/system/stats', { headers: { 'Authorization': `Bearer ${authToken}` } }),
                    fetch('/api/bot/status', { headers: { 'Authorization': `Bearer ${authToken}` } }),
                    fetch('/api/system/info', { headers: { 'Authorization': `Bearer ${authToken}` } }),
                    fetch('/api/system/storage', { headers: { 'Authorization': `Bearer ${authToken}` } })
                ]);

                const stats = await statsRes.json();
                const bot = await botRes.json();
                const sys = await sysRes.json();
                const storage = await storageRes.json();

                if (stats.success) updateDashboardStats(stats);
                if (bot.success) updateBotDashboardStats(bot);
                if (sys.success) updateSystemInfo(sys);
                if (storage.success) updateStorageInfo(storage);

            } catch (error) {
                console.error('Error loading dashboard:', error);
                showToast('Error cargando el dashboard', 'error');
            }
        }

        function updateDashboardStats(stats) {
            // Memoria
            const memUsed = formatBytes(stats.memory?.used || 0);
            const memTotal = formatBytes(stats.memory?.total || stats.memory?.used * 2 || 1);
            const memPercent = Math.min(100, ((stats.memory?.used || 0) / (stats.memory?.total || stats.memory?.used * 2 || 1)) * 100);
            
            document.getElementById('memUsed').textContent = memUsed;
            document.getElementById('heapUsed').textContent = formatBytes(stats.memory?.heapUsed || 0);
            document.getElementById('memProgress').style.width = `${memPercent}%`;

            // CPU
            const cpuPercent = Math.min(100, (stats.cpu?.load || 0) * 100);
            document.getElementById('cpuUsed').textContent = `${cpuPercent.toFixed(1)}%`;
            document.getElementById('cpuProgress').style.width = `${cpuPercent}%`;
            document.getElementById('uptime').textContent = formatTime(stats.uptime || 0);
        }

        function updateBotDashboardStats(bot) {
            document.getElementById('botStatus').textContent = bot.connected ? 'üü¢ Online' : 'üî¥ Offline';
            document.getElementById('subBotsCount').textContent = bot.subBots || 0;
            document.getElementById('botUptime').textContent = formatTime(bot.uptime || 0);
            
            if (bot.connected && bot.user) {
                document.getElementById('botUserName').textContent = bot.user.name || 'Sin nombre';
                document.getElementById('botId').textContent = bot.user.id || '-';
            }
        }

        function updateSystemInfo(sys) {
            document.getElementById('pluginsCount').textContent = sys.plugins || 0;
            document.getElementById('pluginsProgress').style.width = `${Math.min(100, (sys.plugins || 0) / 100 * 100)}%`;
            
            document.getElementById('sessionsCount').textContent = sys.sessions || 0;
            document.getElementById('chatsCount').textContent = sys.chats || 0;
            document.getElementById('sessionsProgress').style.width = `${Math.min(100, (sys.chats || 0) / 1000 * 100)}%`;
        }

        function updateStorageInfo(storage) {
            if (storage.current) {
                const used = storage.current.total || 0;
                const total = used * 3 || 1; // Estimaci√≥n
                const percent = Math.min(100, (used / total) * 100);
                
                document.getElementById('storageUsed').textContent = formatBytes(used, 2);
                document.getElementById('storageInfo').textContent = `${formatBytes(used)} / ${formatBytes(total)}`;
                document.getElementById('storageProgress').style.width = `${percent}%`;
                
                // Actualizar sidebar
                document.getElementById('sidebarStorageProgress').style.width = `${percent}%`;
                document.getElementById('sidebarStorageText').textContent = `${formatBytes(used)} / ${formatBytes(total)}`;
            }
        }

        function startSystemMonitoring() {
            // Monitorear rendimiento cada 5 segundos
            setInterval(() => {
                updateWebPerformance();
            }, 5000);
            
            // Monitorear conexi√≥n
            setInterval(() => {
                if (socket && socket.connected) {
                    socket.emit('ping', Date.now());
                }
            }, 30000);
        }

        function updateWebPerformance() {
            // Simular m√©tricas de rendimiento
            const latency = Math.floor(Math.random() * 100) + 20;
            const perf = 100 - Math.floor(latency / 2);
            
            document.getElementById('webPerf').textContent = `${perf}%`;
            document.getElementById('webPerfProgress').style.width = `${perf}%`;
            document.getElementById('latency').textContent = `${latency}ms`;
            
            // Actualizar seguridad (siempre 100% por ahora)
            document.getElementById('securityStatus').textContent = '100%';
            document.getElementById('securityProgress').style.width = '100%';
        }

        // ============================================
        // GESTI√ìN DE ARCHIVOS COMPLETA
        // ============================================
        
        async function loadFiles(path = currentPath) {
            showLoading();
            
            try {
                const response = await fetch('/api/files/list', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ path })
                });

                const data = await response.json();

                if (data.success) {
                    currentPath = data.path;
                    renderBreadcrumb(data.path);
                    renderFileList(data.files);
                    updateSelectionInfo();
                } else {
                    showToast(data.error || 'Error cargando archivos', 'error');
                }
            } catch (error) {
                showToast('Error de conexi√≥n cargando archivos', 'error');
            } finally {
                hideLoading();
            }
        }

        function renderBreadcrumb(fullPath) {
            const parts = fullPath.split('/').filter(p => p);
            let html = '<span class="breadcrumb-item" onclick="navigateTo(\'.\')">Inicio</span>';
            let current = '';

            parts.forEach((part, i) => {
                current += '/' + part;
                html += `<span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>`;
                html += `<span class="breadcrumb-item" onclick="navigateTo('${current}')">${part}</span>`;
            });

            document.getElementById('breadcrumb').innerHTML = html;
        }

        function setFileView(mode) {
            fileViewMode = mode;
            
            // Actualizar botones
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Mostrar/ocultar vistas
            document.getElementById('fileGridView').style.display = mode === 'grid' ? 'grid' : 'none';
            document.getElementById('fileTableView').style.display = mode === 'list' ? 'table' : 'none';
            document.getElementById('fileIconsView').style.display = mode === 'icons' ? 'grid' : 'none';
        }

        function renderFileList(files) {
            // Limpiar vistas
            document.getElementById('fileGridView').innerHTML = '';
            document.getElementById('fileListBody').innerHTML = '';
            document.getElementById('fileIconsView').innerHTML = '';
            
            // Contadores
            let totalSize = 0;
            let folderCount = 0;
            let fileCount = 0;

            files.forEach(file => {
                const iconClass = getFileIcon(file.name);
                const icon = getFileIconClass(file.name);
                const isSelected = selectedFiles.has(file.path);
                
                if (file.type === 'directory') {
                    folderCount++;
                } else {
                    fileCount++;
                    totalSize += file.size || 0;
                }

                // Vista de cuadr√≠cula
                const gridItem = document.createElement('div');
                gridItem.className = `file-item ${iconClass} ${isSelected ? 'selected' : ''}`;
                gridItem.dataset.path = file.path;
                gridItem.onclick = (e) => handleFileClick(e, file.path, file.type, gridItem);
                gridItem.ondblclick = () => openItem(file.path, file.type);

                gridItem.innerHTML = `
                    <div class="file-item-icon">
                        <i class="fas ${icon}"></i>
                    </div>
                    <div class="file-item-name" title="${file.name}">${file.name}</div>
                    <div class="file-item-size">${file.type === 'directory' ? 'Carpeta' : formatBytes(file.size)}</div>
                    <input type="checkbox" class="file-checkbox" style="position: absolute; top: 10px; right: 10px;" 
                           ${isSelected ? 'checked' : ''} 
                           onclick="event.stopPropagation(); toggleFileSelection('${file.path}', this.checked); this.parentElement.classList.toggle('selected')">
                `;

                document.getElementById('fileGridView').appendChild(gridItem);

                // Vista de tabla
                const tableRow = document.createElement('tr');
                tableRow.className = `file-row ${isSelected ? 'selected' : ''}`;
                tableRow.dataset.path = file.path;
                tableRow.onclick = (e) => handleFileClick(e, file.path, file.type, tableRow);

                tableRow.innerHTML = `
                    <td><input type="checkbox" class="file-checkbox" data-path="${file.path}" 
                           ${isSelected ? 'checked' : ''} 
                           onchange="toggleFileSelection('${file.path}', this.checked); this.closest('tr').classList.toggle('selected')"></td>
                    <td>
                        <div class="file-name-cell">
                            <div class="file-icon ${iconClass}">
                                <i class="fas ${icon}"></i>
                            </div>
                            <span>${file.name}</span>
                        </div>
                    </td>
                    <td>${file.type === 'directory' ? '‚Äî' : formatBytes(file.size)}</td>
                    <td>${getFileType(file.name)}</td>
                    <td>${new Date(file.modified).toLocaleString()}</td>
                    <td>
                        <button class="toolbar-btn" onclick="event.stopPropagation(); renameItem('${file.path}')" title="Renombrar">
                            <i class="fas fa-edit"></i>
                        </button>
                        ${file.type === 'file' ? `
                        <button class="toolbar-btn" onclick="event.stopPropagation(); editFile('${file.path}')" title="Editar">
                            <i class="fas fa-code"></i>
                        </button>
                        ` : ''}
                        <button class="toolbar-btn" onclick="event.stopPropagation(); showFileInfo('${file.path}')" title="Informaci√≥n">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </td>
                `;

                document.getElementById('fileListBody').appendChild(tableRow);

                // Vista de √≠conos
                const iconItem = document.createElement('div');
                iconItem.className = `file-item ${iconClass} ${isSelected ? 'selected' : ''}`;
                iconItem.dataset.path = file.path;
                iconItem.onclick = (e) => handleFileClick(e, file.path, file.type, iconItem);
                iconItem.ondblclick = () => openItem(file.path, file.type);

                iconItem.innerHTML = `
                    <div class="file-item-icon" style="width: 80px; height: 80px; font-size: 2rem;">
                        <i class="fas ${icon}"></i>
                    </div>
                    <div class="file-item-name" title="${file.name}" style="font-size: 0.9rem; text-align: center; margin-top: 10px;">${truncateText(file.name, 15)}</div>
                    <input type="checkbox" class="file-checkbox" style="position: absolute; top: 10px; right: 10px;" 
                           ${isSelected ? 'checked' : ''} 
                           onclick="event.stopPropagation(); toggleFileSelection('${file.path}', this.checked); this.parentElement.classList.toggle('selected')">
                `;

                document.getElementById('fileIconsView').appendChild(iconItem);
            });

            // Mostrar estad√≠sticas
            const statsText = `${files.length} elementos (${folderCount} carpetas, ${fileCount} archivos, ${formatBytes(totalSize)})`;
            showToast(statsText, 'info');
            
            // Actualizar badge de plugins
            const pluginsBadge = document.getElementById('pluginsBadge');
            if (pluginsBadge) {
                const pluginCount = files.filter(f => f.name.endsWith('.js')).length;
                pluginsBadge.textContent = pluginCount;
                pluginsBadge.style.display = pluginCount > 0 ? 'inline-block' : 'none';
            }
        }

        function handleFileClick(e, path, type, element) {
            if (e.ctrlKey || e.metaKey) {
                // Selecci√≥n m√∫ltiple con Ctrl
                const isSelected = selectedFiles.has(path);
                toggleFileSelection(path, !isSelected);
                element.classList.toggle('selected');
            } else if (e.shiftKey) {
                // Selecci√≥n por rango con Shift
                // Implementaci√≥n b√°sica - puede mejorarse
                const isSelected = selectedFiles.has(path);
                toggleFileSelection(path, !isSelected);
                element.classList.toggle('selected');
            } else {
                // Click simple - abrir elemento
                openItem(path, type);
            }
            updateSelectionInfo();
        }

        function getFileIcon(filename) {
            if (filename.endsWith('/')) return 'folder';
            
            const ext = filename.split('.').pop().toLowerCase();
            const imageExts = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg', 'bmp', 'ico', 'tiff'];
            const codeExts = ['js', 'jsx', 'ts', 'tsx', 'html', 'htm', 'css', 'scss', 'less', 'json', 'md', 'txt', 'py', 'sh', 'php', 'java', 'cpp', 'c', 'h', 'xml', 'yml', 'yaml', 'sql'];
            const audioExts = ['mp3', 'wav', 'ogg', 'm4a', 'flac', 'aac'];
            const videoExts = ['mp4', 'avi', 'mov', 'mkv', 'webm', 'flv', 'wmv'];
            const archiveExts = ['zip', 'rar', '7z', 'tar', 'gz', 'bz2'];
            const documentExts = ['pdf', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];

            if (imageExts.includes(ext)) return 'image';
            if (codeExts.includes(ext)) return 'code';
            if (audioExts.includes(ext)) return 'audio';
            if (videoExts.includes(ext)) return 'video';
            if (archiveExts.includes(ext)) return 'archive';
            if (documentExts.includes(ext)) return 'document';
            return 'file';
        }

        function getFileIconClass(filename) {
            const icon = getFileIcon(filename);
            const icons = {
                folder: 'fa-folder',
                image: 'fa-file-image',
                code: 'fa-file-code',
                audio: 'fa-file-audio',
                video: 'fa-file-video',
                archive: 'fa-file-archive',
                document: 'fa-file-alt',
                file: 'fa-file'
            };
            return icons[icon] || 'fa-file';
        }

        function getFileType(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const types = {
                'js': 'JavaScript',
                'jsx': 'React JSX',
                'ts': 'TypeScript',
                'tsx': 'React TSX',
                'html': 'HTML',
                'htm': 'HTML',
                'css': 'CSS',
                'scss': 'SCSS',
                'less': 'LESS',
                'json': 'JSON',
                'md': 'Markdown',
                'txt': 'Texto',
                'py': 'Python',
                'sh': 'Shell',
                'php': 'PHP',
                'java': 'Java',
                'cpp': 'C++',
                'c': 'C',
                'h': 'Header',
                'xml': 'XML',
                'yml': 'YAML',
                'yaml': 'YAML',
                'sql': 'SQL',
                'jpg': 'JPEG Image',
                'jpeg': 'JPEG Image',
                'png': 'PNG Image',
                'gif': 'GIF Image',
                'webp': 'WebP Image',
                'svg': 'SVG Image',
                'mp3': 'MP3 Audio',
                'wav': 'WAV Audio',
                'mp4': 'MP4 Video',
                'avi': 'AVI Video',
                'mov': 'MOV Video',
                'pdf': 'PDF Document',
                'doc': 'Word Document',
                'docx': 'Word Document',
                'zip': 'ZIP Archive',
                'rar': 'RAR Archive'
            };
            
            if (ext === '') return 'Carpeta';
            return types[ext] || `Archivo .${ext.toUpperCase()}`;
        }

        function navigateTo(path) {
            loadFiles(path);
        }

        function openItem(path, type) {
            if (type === 'directory') {
                loadFiles(path);
            } else {
                editFile(path);
            }
        }

        function toggleSelectAll(e) {
            const checkboxes = document.querySelectorAll('.file-checkbox');
            const items = document.querySelectorAll('.file-item, .file-row');
            
            checkboxes.forEach(cb => {
                cb.checked = e.target.checked;
                const path = cb.dataset.path || cb.closest('.file-item')?.dataset.path;
                if (path) {
                    toggleFileSelection(path, e.target.checked);
                }
            });
            
            items.forEach(item => {
                item.classList.toggle('selected', e.target.checked);
            });
            
            updateSelectionInfo();
        }

        function toggleFileSelection(path, selected) {
            if (selected) {
                selectedFiles.add(path);
            } else {
                selectedFiles.delete(path);
            }
        }

        function updateSelectionInfo() {
            const infoDiv = document.getElementById('selectionInfo');
            const countSpan = document.getElementById('selectedCount');
            const sizeSpan = document.getElementById('selectedSize');
            
            if (selectedFiles.size > 0) {
                // Calcular tama√±o total
                let totalSize = 0;
                selectedFiles.forEach(path => {
                    // Aqu√≠ podr√≠as obtener el tama√±o real de cada archivo
                    // Por ahora usamos un valor simulado
                    totalSize += 1024; // 1KB por archivo
                });
                
                countSpan.textContent = selectedFiles.size;
                sizeSpan.textContent = formatBytes(totalSize);
                infoDiv.style.display = 'block';
            } else {
                infoDiv.style.display = 'none';
            }
        }

        function clearSelection() {
            selectedFiles.clear();
            document.querySelectorAll('.file-checkbox').forEach(cb => cb.checked = false);
            document.querySelectorAll('.file-item, .file-row').forEach(item => item.classList.remove('selected'));
            document.getElementById('selectAll').checked = false;
            updateSelectionInfo();
        }

        function refreshFiles() {
            loadFiles(currentPath);
        }

        // ============================================
        // EDITOR DE C√ìDIGO COMPLETO
        // ============================================
        
        async function editFile(filePath) {
            showLoading();
            
            try {
                const response = await fetch('/api/files/read', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ path: filePath })
                });

                const data = await response.json();

                if (data.success) {
                    currentFile = filePath;
                    document.getElementById('editorPath').textContent = filePath;
                    
                    const editor = document.getElementById('codeEditor');
                    editor.value = data.content;
                    editor.defaultValue = data.content; // Para detectar cambios
                    
                    updateFileInfo(data.content);
                    updateLineNumbers();
                    updateEditorStatus();
                    detectLanguage(filePath);
                    
                    switchView('editor');
                    
                    // Activar auto-guardado si est√° configurado
                    if (userSettings.editor.autoSave) {
                        setupAutoSave();
                    }
                } else {
                    showToast(data.error || 'Error abriendo archivo', 'error');
                }
            } catch (error) {
                showToast('Error abriendo archivo', 'error');
            } finally {
                hideLoading();
            }
        }

        function updateFileInfo(content) {
            const lines = content.split('\n').length;
            const words = content.split(/\s+/).filter(w => w.length > 0).length;
            const size = new Blob([content]).size;
            
            document.getElementById('fileSize').textContent = formatBytes(size);
            document.getElementById('fileLines').textContent = `${lines} l√≠neas`;
            document.getElementById('wordCount').textContent = words;
        }

        function detectLanguage(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const langMap = {
                'js': 'javascript',
                'jsx': 'javascript',
                'ts': 'javascript',
                'tsx': 'javascript',
                'html': 'html',
                'htm': 'html',
                'css': 'css',
                'scss': 'css',
                'less': 'css',
                'json': 'json',
                'md': 'markdown',
                'txt': 'text',
                'py': 'python',
                'sh': 'bash',
                'php': 'php',
                'java': 'java',
                'cpp': 'cpp',
                'c': 'c',
                'h': 'c',
                'xml': 'xml',
                'yml': 'yaml',
                'yaml': 'yaml',
                'sql': 'sql'
            };
            
            const selector = document.getElementById('languageSelector');
            selector.value = langMap[ext] || 'auto';
        }

        function changeEditorLanguage() {
            const lang = document.getElementById('languageSelector').value;
            showToast(`Lenguaje cambiado a: ${lang}`, 'info');
            
            // Aqu√≠ podr√≠as agregar resaltado de sintaxis seg√∫n el lenguaje
            // Por ejemplo, usando una librer√≠a como Prism.js o Highlight.js
        }

        async function saveFile() {
            if (!currentFile) {
                showToast('No hay archivo abierto para guardar', 'warning');
                return;
            }

            try {
                const content = document.getElementById('codeEditor').value;
                const saveBtn = document.getElementById('saveBtn');
                
                // Animaci√≥n de guardado
                saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Guardando...';
                saveBtn.disabled = true;

                const response = await fetch('/api/files/save', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ path: currentFile, content })
                });

                const data = await response.json();

                if (data.success) {
                    // Actualizar valor por defecto para detectar cambios
                    document.getElementById('codeEditor').defaultValue = content;
                    
                    showToast('‚úÖ Archivo guardado exitosamente', 'success');
                    document.getElementById('editorStatus').textContent = 'Guardado';
                    updateFileInfo(content);
                    
                    // Registrar actividad
                    logUserActivity('file_save', `Archivo guardado: ${currentFile}`);
                } else {
                    showToast(data.error || 'Error guardando archivo', 'error');
                }
            } catch (error) {
                showToast('Error guardando archivo', 'error');
            } finally {
                // Restaurar bot√≥n
                setTimeout(() => {
                    const saveBtn = document.getElementById('saveBtn');
                    if (saveBtn) {
                        saveBtn.innerHTML = '<i class="fas fa-save"></i> Guardar';
                        saveBtn.disabled = false;
                    }
                }, 1000);
            }
        }

        function downloadFile() {
            if (!currentFile) {
                showToast('No hay archivo abierto para descargar', 'warning');
                return;
            }

            const content = document.getElementById('codeEditor').value;
            const filename = currentFile.split('/').pop();
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Archivo descargado', 'success');
        }

        function formatCode() {
            const editor = document.getElementById('codeEditor');
            const content = editor.value;
            const language = document.getElementById('languageSelector').value;
            
            try {
                let formatted = content;
                
                // Formato b√°sico seg√∫n lenguaje
                switch(language) {
                    case 'json':
                        const parsed = JSON.parse(content);
                        formatted = JSON.stringify(parsed, null, 2);
                        break;
                        
                    case 'javascript':
                    case 'html':
                    case 'css':
                        // Formato b√°sico - podr√≠as integrar una librer√≠a como Prettier
                        formatted = content
                            .replace(/\s+$/gm, '') // Eliminar espacios al final de l√≠nea
                            .replace(/\n{3,}/g, '\n\n') // M√°ximo 2 saltos de l√≠nea seguidos
                            .replace(/\t/g, '    '); // Tabs a espacios
                        break;
                        
                    default:
                        formatted = content.trim();
                }
                
                editor.value = formatted;
                showToast('C√≥digo formateado', 'success');
                updateEditorStatus();
                updateLineNumbers();
                
            } catch (error) {
                showToast('No se pudo formatear el c√≥digo', 'warning');
            }
        }

        function findInFile() {
            const searchTerm = prompt('Buscar en el archivo:', '');
            if (!searchTerm) return;
            
            const editor = document.getElementById('codeEditor');
            const content = editor.value;
            const regex = new RegExp(searchTerm, 'gi');
            const matches = content.match(regex);
            
            if (matches) {
                showToast(`Encontradas ${matches.length} coincidencias`, 'info');
                // Aqu√≠ podr√≠as implementar resaltado de resultados
            } else {
                showToast('No se encontraron coincidencias', 'warning');
            }
        }

        function updateEditorStatus() {
            const editor = document.getElementById('codeEditor');
            const hasChanges = editor.value !== editor.defaultValue;
            document.getElementById('editorStatus').textContent = hasChanges ? 'Cambios sin guardar' : 'Sin cambios';
            
            // Actualizar bot√≥n de guardar
            const saveBtn = document.getElementById('saveBtn');
            if (saveBtn) {
                saveBtn.style.background = hasChanges ? 
                    'linear-gradient(135deg, rgba(255, 46, 99, 0.2), rgba(255, 46, 99, 0.4))' :
                    'rgba(26, 26, 37, 0.7)';
            }
        }

        function updateCursorPosition() {
            const editor = document.getElementById('codeEditor');
            const cursorPos = editor.selectionStart;
            const textBeforeCursor = editor.value.substring(0, cursorPos);
            const lines = textBeforeCursor.split('\n');
            const line = lines.length;
            const column = lines[lines.length - 1].length + 1;
            
            document.getElementById('currentLine').textContent = line;
            document.getElementById('currentColumn').textContent = column;
        }

        function updateLineNumbers() {
            const textarea = document.getElementById('codeEditor');
            const lines = textarea.value.split('\n').length;
            document.getElementById('lineNumbers').innerHTML = 
                Array.from({length: lines}, (_, i) => i + 1).join('\n');
        }

        function syncScroll() {
            const textarea = document.getElementById('codeEditor');
            document.getElementById('lineNumbers').scrollTop = textarea.scrollTop;
        }

        function handleEditorShortcuts(e) {
            // Ctrl+S para guardar
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                saveFile();
            }
            
            // Ctrl+F para buscar
            if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                e.preventDefault();
                findInFile();
            }
            
            // Ctrl+Z/Y para deshacer/rehacer (manejo b√°sico)
            if ((e.ctrlKey || e.metaKey) && e.key === 'z') {
                // El navegador maneja esto por defecto
                setTimeout(updateEditorStatus, 0);
            }
        }

        function setupAutoSave() {
            if (autoSaveInterval) clearInterval(autoSaveInterval);
            
            autoSaveInterval = setInterval(() => {
                const editor = document.getElementById('codeEditor');
                if (editor && editor.value !== editor.defaultValue) {
                    saveFile();
                    showToast('Auto-guardado realizado', 'info', 2000);
                }
            }, userSettings.editor.autoSaveInterval);
        }

        function closeEditor() {
            const editor = document.getElementById('codeEditor');
            if (editor.value !== editor.defaultValue) {
                if (confirm('Tienes cambios sin guardar. ¬øSeguro que quieres cerrar?')) {
                    resetEditor();
                    switchView('files');
                }
            } else {
                resetEditor();
                switchView('files');
            }
        }

        function resetEditor() {
            currentFile = null;
            const editor = document.getElementById('codeEditor');
            editor.value = '';
            editor.defaultValue = '';
            document.getElementById('editorPath').textContent = 'Sin archivo abierto';
            document.getElementById('editorStatus').textContent = 'Sin cambios';
            document.getElementById('fileSize').textContent = '0 B';
            document.getElementById('fileLines').textContent = '0 l√≠neas';
            document.getElementById('wordCount').textContent = '0';
            
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
                autoSaveInterval = null;
            }
        }

        // ============================================
        // CONSOLA EN TIEMPO REAL
        // ============================================
        
        function appendToConsole(text, type = 'normal') {
            const output = document.getElementById('consoleOutput');
            const line = document.createElement('div');
            line.className = `console-line ${type}`;
            
            // Agregar timestamp si est√° configurado
            const timestamp = userSettings.console.showTimestamp ? 
                `<span style="color: var(--text-secondary); font-size: 0.8rem;">[${new Date().toLocaleTimeString()}]</span> ` : '';
            
            // Agregar icono seg√∫n el tipo
            const icons = {
                error: 'fa-exclamation-circle',
                success: 'fa-check-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle',
                log: 'fa-terminal'
            };
            
            const icon = icons[type] || 'fa-terminal';
            line.innerHTML = `${timestamp}<i class="fas ${icon}"></i> ${text}`;
            output.appendChild(line);
            
            if (autoScroll) {
                output.scrollTop = output.scrollHeight;
            }
        }

        function executeCommand() {
            const input = document.getElementById('consoleInput');
            const command = input.value.trim();

            if (!command) return;

            // Agregar a historial
            commandHistory.push(command);
            if (commandHistory.length > userSettings.console.historySize) {
                commandHistory.shift();
            }
            historyIndex = commandHistory.length;
            
            // Mostrar comando en consola
            const prompt = document.getElementById('consolePrompt').textContent;
            appendToConsole(`<span style="color: var(--accent-primary);">${prompt}</span> ${command}`, 'log');

            if (shellMode) {
                socket.emit('input', command);
            } else {
                socket.emit('execute', command);
            }

            input.value = '';
            input.focus();
        }

        function handleConsoleKeypress(e) {
            if (e.key === 'Enter') {
                executeCommand();
            }
        }

        function handleConsoleNavigation(e) {
            if (e.key === 'ArrowUp') {
                navigateCommandHistory(-1);
            } else if (e.key === 'ArrowDown') {
                navigateCommandHistory(1);
            }
        }

        function navigateCommandHistory(direction) {
            if (commandHistory.length === 0) return;
            
            historyIndex = Math.max(0, Math.min(commandHistory.length, historyIndex + direction));
            
            const input = document.getElementById('consoleInput');
            if (historyIndex >= 0 && historyIndex < commandHistory.length) {
                input.value = commandHistory[historyIndex];
            } else {
                input.value = '';
            }
        }

        function startInteractiveShell() {
            const shellBtn = document.getElementById('shellBtn');
            
            if (!shellMode) {
                shellMode = true;
                shellBtn.innerHTML = '<i class="fas fa-terminal"></i> Shell Activo';
                shellBtn.style.background = 'linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.4))';
                shellBtn.style.borderColor = 'var(--success)';
                
                socket.emit('spawn', process.platform === 'win32' ? 'cmd' : 'bash');
                appendToConsole('üîÑ Iniciando shell interactivo...', 'warning');
                appendToConsole('Escribe "exit" para salir del shell', 'info');
            } else {
                shellMode = false;
                shellBtn.innerHTML = '<i class="fas fa-terminal"></i> Shell Interactivo';
                shellBtn.style.background = '';
                shellBtn.style.borderColor = '';
                
                socket.emit('input', 'exit');
                appendToConsole('Shell interactivo cerrado', 'info');
            }
        }

        function clearConsole() {
            document.getElementById('consoleOutput').innerHTML = '';
            appendToConsole('Consola limpiada', 'info');
        }

        function toggleAutoScroll() {
            autoScroll = !autoScroll;
            const icon = document.getElementById('autoScrollIcon');
            if (autoScroll) {
                icon.classList.remove('fa-scroll');
                icon.classList.add('fa-scroll');
                showToast('Auto-scroll activado', 'info');
            } else {
                icon.classList.remove('fa-scroll');
                icon.classList.add('fa-scroll');
                showToast('Auto-scroll desactivado', 'info');
            }
        }

        function exportConsoleLogs() {
            const logs = document.getElementById('consoleOutput').innerText;
            const blob = new Blob([logs], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `console_logs_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Logs de consola exportados', 'success');
        }

        function showCommandHistory() {
            if (commandHistory.length === 0) {
                showToast('No hay historial de comandos', 'info');
                return;
            }
            
            const content = `
                <div style="max-height: 400px; overflow-y: auto;">
                    ${commandHistory.map((cmd, i) => `
                        <div style="padding: 10px; margin-bottom: 5px; background: rgba(255,255,255,0.05); border-radius: 5px; cursor: pointer;" 
                             onclick="useCommandFromHistory(${i})">
                            <strong>${i + 1}.</strong> ${cmd}
                        </div>
                    `).join('')}
                </div>
                <div class="modal-actions">
                    <button class="btn-secondary" onclick="closeModal()">Cerrar</button>
                    <button class="btn-primary" onclick="clearCommandHistory(); closeModal();">Limpiar Historial</button>
                </div>
            `;
            
            showModal('Historial de Comandos', `Total: ${commandHistory.length} comandos`, content);
        }

        function useCommandFromHistory(index) {
            const cmd = commandHistory[index];
            document.getElementById('consoleInput').value = cmd;
            closeModal();
            document.getElementById('consoleInput').focus();
        }

        function clearCommandHistory() {
            commandHistory = [];
            showToast('Historial de comandos limpiado', 'success');
        }

        function runQuickCommand(command) {
            const commands = {
                'status': 'systemctl status astabot',
                'help': 'help',
                'list': 'ls -la',
                'processes': 'ps aux | grep node',
                'memory': 'free -h',
                'disk': 'df -h'
            };
            
            if (commands[command]) {
                document.getElementById('consoleInput').value = commands[command];
                executeCommand();
            }
        }

        // ============================================
        // CONTROL DEL BOT
        // ============================================
        
        async function loadBotStatus() {
            try {
                const [statusRes, statsRes] = await Promise.all([
                    fetch('/api/bot/status', { headers: { 'Authorization': `Bearer ${authToken}` } }),
                    fetch('/api/bot/stats', { headers: { 'Authorization': `Bearer ${authToken}` } })
                ]);

                const status = await statusRes.json();
                const stats = await statsRes.json();

                if (status.success) updateBotStatusUI(status);
                if (stats.success) updateBotStatsUI(stats);

            } catch (error) {
                console.error('Error:', error);
                showToast('Error cargando estado del bot', 'error');
            }
        }

        function updateBotStatusUI(data) {
            const dot = document.getElementById('statusDot');
            const text = document.getElementById('statusText');
            const number = document.getElementById('botNumber');
            const startBtn = document.getElementById('startBtn');
            const restartBtn = document.getElementById('restartBtn');
            const stopBtn = document.getElementById('stopBtn');

            if (data.connected) {
                dot.className = 'status-dot online';
                text.textContent = `üü¢ Conectado - ${data.user?.name || 'Usuario'}`;
                text.style.color = 'var(--success)';
                number.textContent = `#${data.user?.id?.split(':')[0] || '0000'}`;
                
                // Actualizar informaci√≥n detallada
                document.getElementById('botUserName').textContent = data.user?.name || 'Sin nombre';
                document.getElementById('botId').textContent = data.user?.id || '-';
                document.getElementById('botUptimeDetail').textContent = formatTime(data.uptime || 0);
                document.getElementById('activeSubBots').textContent = data.subBots || 0;
                document.getElementById('activePlugins').textContent = data.plugins || 0;
                document.getElementById('lastConnection').textContent = new Date().toLocaleString();
                
                // Habilitar/deshabilitar botones
                startBtn.disabled = true;
                restartBtn.disabled = false;
                stopBtn.disabled = false;
                
            } else {
                dot.className = 'status-dot offline';
                text.textContent = 'üî¥ Desconectado';
                text.style.color = 'var(--error)';
                number.textContent = '#0000';
                
                // Habilitar/deshabilitar botones
                startBtn.disabled = false;
                restartBtn.disabled = true;
                stopBtn.disabled = true;
            }
        }

        function updateBotStatsUI(stats) {
            if (!stats.stats) return;
            
            document.getElementById('processedMessages').textContent = stats.stats.messages || 0;
            document.getElementById('executedCommands').textContent = stats.stats.commands || 0;
            document.getElementById('uniqueUsers').textContent = stats.stats.uniqueUsers || 0;
            document.getElementById('activeGroups').textContent = stats.stats.activeGroups || 0;
            
            const responseRate = stats.stats.messages > 0 
                ? Math.round((stats.stats.commands / stats.stats.messages) * 100) 
                : 0;
            document.getElementById('responseRate').textContent = `${responseRate}%`;
            
            document.getElementById('systemUptime').textContent = formatTime(process.uptime() || 0);
        }

        async function startBot() {
            if (!confirm('¬øIniciar el bot?')) return;

            try {
                const response = await fetch('/api/bot/start', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const data = await response.json();
                
                if (data.success) {
                    showToast('‚úÖ Bot iniciado exitosamente', 'success');
                    setTimeout(() => loadBotStatus(), 2000);
                } else {
                    showToast(data.error || 'Error iniciando bot', 'error');
                }
            } catch (error) {
                showToast('Error iniciando bot', 'error');
            }
        }

        async function restartBot() {
            if (!confirm('¬øReiniciar el bot? Esto puede tomar unos segundos.')) return;

            try {
                const response = await fetch('/api/bot/restart', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const data = await response.json();
                
                if (data.success) {
                    showToast('üîÑ Reiniciando bot...', 'warning');
                    setTimeout(() => loadBotStatus(), 5000);
                }
            } catch (error) {
                showToast('Error reiniciando bot', 'error');
            }
        }

        async function stopBot() {
            if (!confirm('¬øApagar el bot? No podr√°s acceder hasta reiniciar manualmente.')) return;

            try {
                const response = await fetch('/api/bot/stop', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const data = await response.json();
                
                if (data.success) {
                    showToast('üî¥ Apagando bot...', 'error');
                    setTimeout(() => loadBotStatus(), 2000);
                }
            } catch (error) {
                showToast('Error apagando bot', 'error');
            }
        }

        function sendBotCommand(command) {
            const commands = {
                'ping': 'ping',
                'status': 'status',
                'reload': 'reload',
                'broadcast': 'broadcast Hello from AstaFile!',
                'backup': 'backup',
                'update': 'update'
            };
            
            if (commands[command]) {
                appendToConsole(`Enviando comando al bot: ${commands[command]}`, 'info');
                // Aqu√≠ enviar√≠as el comando al bot via WebSocket
                if (socket) {
                    socket.emit('bot:command', { 
                        command: command === 'reload' ? 'reload' : 'execute',
                        args: commands[command]
                    });
                }
            }
        }

        function showBotConfig() {
            const content = `
                <div class="form-group">
                    <label>Nombre del Bot</label>
                    <input type="text" id="botName" value="Asta Bot" placeholder="Nombre del bot">
                </div>
                <div class="form-group">
                    <label>Prefijo de Comandos</label>
                    <input type="text" id="botPrefix" value="." placeholder="Prefijo">
                </div>
                <div class="form-group">
                    <label>L√≠mite de Sub-Bots</label>
                    <input type="number" id="maxSubBots" value="100" min="1" max="1000">
                </div>
                <div class="form-group">
                    <label>Auto-reinicio</label>
                    <select id="autoRestart">
                        <option value="true">Activado</option>
                        <option value="false">Desactivado</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Logs Detallados</label>
                    <select id="verboseLogs">
                        <option value="false">B√°sico</option>
                        <option value="true">Detallado</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button class="btn-secondary" onclick="closeModal()">Cancelar</button>
                    <button class="btn-primary" onclick="saveBotConfig()">Guardar Configuraci√≥n</button>
                </div>
            `;
            showModal('Configuraci√≥n del Bot', 'Ajusta los par√°metros del bot', content);
        }

        function saveBotConfig() {
            showToast('Configuraci√≥n del bot guardada', 'success');
            closeModal();
        }

        function showCustomCommandModal() {
            const content = `
                <div class="form-group">
                    <label>Comando Personalizado</label>
                    <input type="text" id="customCommand" placeholder="Ej: !help o /status" autofocus>
                </div>
                <div class="form-group">
                    <label>Argumentos (opcional)</label>
                    <input type="text" id="commandArgs" placeholder="Argumentos del comando">
                </div>
                <div class="modal-actions">
                    <button class="btn-secondary" onclick="closeModal()">Cancelar</button>
                    <button class="btn-primary" onclick="sendCustomCommand()">Enviar Comando</button>
                </div>
            `;
            showModal('Comando Personalizado', 'Env√≠a un comando espec√≠fico al bot', content);
        }

        function sendCustomCommand() {
            const command = document.getElementById('customCommand').value;
            const args = document.getElementById('commandArgs').value;
            
            if (!command) {
                showToast('El comando es requerido', 'error');
                return;
            }
            
            if (socket) {
                socket.emit('bot:command', { 
                    command: 'execute',
                    args: args ? `${command} ${args}` : command
                });
                showToast(`Comando enviado: ${command}`, 'success');
                closeModal();
            }
        }

        function clearBotStats() {
            if (confirm('¬øLimpiar todas las estad√≠sticas del bot?')) {
                systemStats = {
                    messages: 0,
                    commands: 0,
                    users: new Set(),
                    groups: new Set(),
                    startTime: Date.now()
                };
                updateBotStatsUI({ stats: systemStats });
                showToast('Estad√≠sticas limpiadas', 'info');
            }
        }

        function exportBotStats() {
            const stats = {
                ...systemStats,
                users: systemStats.users.size,
                groups: systemStats.groups.size,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(stats, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bot_stats_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Estad√≠sticas del bot exportadas', 'success');
        }

        function updateBotStats() {
            loadBotStatus();
        }

        function showDetailedStats() {
            const content = `
                <div style="padding: 20px;">
                    <h4 style="margin-bottom: 15px; color: var(--accent-primary);">Estad√≠sticas Detalladas</h4>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.9rem; color: var(--text-secondary);">Mensajes Hoy</div>
                            <div style="font-size: 1.5rem; font-weight: bold;">${systemStats.messages}</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.9rem; color: var(--text-secondary);">Comandos Hoy</div>
                            <div style="font-size: 1.5rem; font-weight: bold;">${systemStats.commands}</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.9rem; color: var(--text-secondary);">Usuarios Activos</div>
                            <div style="font-size: 1.5rem; font-weight: bold;">${systemStats.users.size}</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.9rem; color: var(--text-secondary);">Grupos Activos</div>
                            <div style="font-size: 1.5rem; font-weight: bold;">${systemStats.groups.size}</div>
                        </div>
                    </div>
                    <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">Tiempo Activo</div>
                        <div style="font-size: 1.2rem;">${formatTime((Date.now() - systemStats.startTime) / 1000)}</div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn-secondary" onclick="closeModal()">Cerrar</button>
                </div>
            `;
            showModal('Estad√≠sticas Detalladas', 'M√©tricas completas del bot', content);
        }

        function updateSystemStats(data) {
            systemStats.messages += data.messages || 0;
            systemStats.commands += data.commands || 0;
            
            if (data.userId) systemStats.users.add(data.userId);
            if (data.groupId) systemStats.groups.add(data.groupId);
            
            updateBotStatsUI({ stats: systemStats });
        }

        // ============================================
        // LOGS DEL SISTEMA
        // ============================================
        
        function loadSystemLogs() {
            fetch('/api/system/logs', {
                headers: { 'Authorization': `Bearer ${authToken}` }
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    displaySystemLogs(data.logs);
                }
            })
            .catch(console.error);
        }

        function displaySystemLogs(logs) {
            const output = document.getElementById('systemLogsOutput');
            output.innerHTML = '';
            
            logs.forEach(log => {
                appendToSystemLogs(log.message, log.type);
            });
        }

        function appendToSystemLogs(message, type = 'log') {
            const output = document.getElementById('systemLogsOutput');
            const line = document.createElement('div');
            line.className = `console-line ${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            line.innerHTML = `<span style="color: var(--text-secondary); font-size: 0.8rem;">[${timestamp}]</span> ${message}`;
            
            output.appendChild(line);
            
            if (autoScroll) {
                output.scrollTop = output.scrollHeight;
            }
        }

        function clearSystemLogs() {
            document.getElementById('systemLogsOutput').innerHTML = '';
            showToast('Logs del sistema limpiados', 'info');
        }

        function toggleLogsAutoRefresh() {
            logsAutoRefresh = !logsAutoRefresh;
            const icon = document.getElementById('logsRefreshIcon');
            const btn = document.getElementById('logsRefreshBtn');
            
            if (logsAutoRefresh) {
                icon.classList.add('fa-spin');
                btn.style.background = 'linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.4))';
                btn.style.borderColor = 'var(--success)';
                startLogsAutoRefresh();
                showToast('Auto-refresh de logs activado', 'success');
            } else {
                icon.classList.remove('fa-spin');
                btn.style.background = '';
                btn.style.borderColor = '';
                stopLogsAutoRefresh();
                showToast('Auto-refresh de logs desactivado', 'info');
            }
        }

        function startLogsAutoRefresh() {
            if (logsInterval) clearInterval(logsInterval);
            logsInterval = setInterval(() => {
                loadSystemLogs();
            }, 5000);
        }

        function stopLogsAutoRefresh() {
            if (logsInterval) {
                clearInterval(logsInterval);
                logsInterval = null;
            }
        }

        function filterLogs() {
            const filter = document.getElementById('logLevelFilter').value;
            const lines = document.querySelectorAll('#systemLogsOutput .console-line');
            
            lines.forEach(line => {
                const show = filter === 'all' || line.classList.contains(filter);
                line.style.display = show ? 'block' : 'none';
            });
        }

        function searchLogs() {
            const searchTerm = document.getElementById('logSearch').value.toLowerCase();
            const lines = document.querySelectorAll('#systemLogsOutput .console-line');
            
            lines.forEach(line => {
                const text = line.textContent.toLowerCase();
                const show = !searchTerm || text.includes(searchTerm);
                line.style.display = show ? 'block' : 'none';
            });
        }

        function showLogSettings() {
            const content = `
                <div class="form-group">
                    <label>Nivel de Log por Defecto</label>
                    <select id="defaultLogLevel">
                        <option value="info">Info</option>
                        <option value="debug">Debug</option>
                        <option value="warning">Warning</option>
                        <option value="error">Error</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>M√°ximo de Logs en Memoria</label>
                    <input type="number" id="maxLogs" value="1000" min="100" max="10000">
                </div>
                <div class="form-group">
                    <label>Retenci√≥n de Logs</label>
                    <select id="logRetention">
                        <option value="7">7 d√≠as</option>
                        <option value="30">30 d√≠as</option>
                        <option value="90">90 d√≠as</option>
                        <option value="365">1 a√±o</option>
                        <option value="0">Indefinido</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button class="btn-secondary" onclick="closeModal()">Cancelar</button>
                    <button class="btn-primary" onclick="saveLogSettings()">Guardar</button>
                </div>
            `;
            showModal('Configuraci√≥n de Logs', 'Ajusta el comportamiento de los logs', content);
        }

        function saveLogSettings() {
            showToast('Configuraci√≥n de logs guardada', 'success');
            closeModal();
        }

        function exportSystemLogs() {
            const logs = document.getElementById('systemLogsOutput').innerText;
            const blob = new Blob([logs], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `system_logs_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Logs del sistema exportados', 'success');
        }

        // ============================================
        // CONFIGURACI√ìN Y PREFERENCIAS
        // ============================================
        
        function loadSettings() {
            // Cargar configuraci√≥n actual en los campos
            document.getElementById('themeSelect').value = userSettings.theme;
            document.getElementById('languageSelect').value = userSettings.language;
            document.getElementById('notifySuccess').checked = userSettings.notifications.success;
            document.getElementById('notifyError').checked = userSettings.notifications.error;
            document.getElementById('notifyWarning').checked = userSettings.notifications.warning;
            document.getElementById('notifyInfo').checked = userSettings.notifications.info;
            document.getElementById('autoSave').checked = userSettings.editor.autoSave;
            document.getElementById('autoSaveInterval').value = userSettings.editor.autoSaveInterval;
            
            // Actualizar tiempo de sesi√≥n
            updateSessionTime();
        }

        function saveUserSettings() {
            // Guardar configuraci√≥n
            userSettings.theme = document.getElementById('themeSelect').value;
            userSettings.language = document.getElementById('languageSelect').value;
            userSettings.notifications.success = document.getElementById('notifySuccess').checked;
            userSettings.notifications.error = document.getElementById('notifyError').checked;
            userSettings.notifications.warning = document.getElementById('notifyWarning').checked;
            userSettings.notifications.info = document.getElementById('notifyInfo').checked;
            userSettings.editor.autoSave = document.getElementById('autoSave').checked;
            userSettings.editor.autoSaveInterval = parseInt(document.getElementById('autoSaveInterval').value);
            
            // Aplicar cambios
            applyTheme(userSettings.theme);
            saveSettingsToStorage();
            
            // Reconfigurar auto-guardado
            if (userSettings.editor.autoSave) {
                setupAutoSave();
            } else if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
                autoSaveInterval = null;
            }
            
            showToast('Configuraci√≥n guardada exitosamente', 'success');
        }

        function resetUserSettings() {
            if (confirm('¬øRestablecer todas las configuraciones a los valores por defecto?')) {
                userSettings = {
                    theme: 'dark',
                    language: 'es',
                    notifications: {
                        success: true,
                        error: true,
                        warning: true,
                        info: false
                    },
                    editor: {
                        autoSave: true,
                        autoSaveInterval: 30000,
                        fontSize: 14,
                        tabSize: 4,
                        wordWrap: false
                    },
                    console: {
                        historySize: 100,
                        prompt: '$',
                        showTimestamp: true
                    }
                };
                
                saveSettingsToStorage();
                loadSettings();
                applyTheme('dark');
                showToast('Configuraci√≥n restablecida', 'info');
            }
        }

        function saveSettingsToStorage() {
            localStorage.setItem('astafile_settings', JSON.stringify(userSettings));
        }

        function loadUserSettings() {
            const saved = localStorage.getItem('astafile_settings');
            if (saved) {
                try {
                    userSettings = JSON.parse(saved);
                } catch (e) {
                    console.error('Error cargando configuraci√≥n:', e);
                }
            }
        }

        function applyTheme(theme) {
            if (theme === 'auto') {
                theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            }
            
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('astafile_theme', theme);
            
            const icon = document.getElementById('themeIcon');
            if (icon) {
                icon.className = theme === 'dark' ? 'fas fa-moon' : 'fas fa-sun';
            }
            
            // Actualizar selector
            const themeSelect = document.getElementById('themeSelect');
            if (themeSelect) {
                themeSelect.value = theme;
            }
        }

        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme') || 'dark';
            const newTheme = current === 'dark' ? 'light' : 'dark';
            applyTheme(newTheme);
            showToast(`Tema ${newTheme === 'dark' ? 'oscuro' : 'claro'} activado`, 'info');
        }

        function changeTheme(theme) {
            applyTheme(theme);
        }

        function updateSessionTime() {
            const lastLogin = localStorage.getItem('astafile_last_login');
            if (lastLogin) {
                const diff = Date.now() - new Date(lastLogin).getTime();
                const minutes = Math.floor(diff / 60000);
                document.getElementById('sessionTime').textContent = `${minutes} minutos`;
            }
        }

        function changePassword() {
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;
            
            if (!current || !newPass || !confirm) {
                showToast('Todos los campos son requeridos', 'error');
                return;
            }
            
            if (newPass !== confirm) {
                showToast('Las contrase√±as no coinciden', 'error');
                return;
            }
            
            if (newPass.length < 8) {
                showToast('La contrase√±a debe tener al menos 8 caracteres', 'error');
                return;
            }
            
            // Aqu√≠ enviar√≠as la solicitud al servidor
            showToast('Contrase√±a cambiada exitosamente', 'success');
            
            // Limpiar campos
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }

        function showActivityLog() {
            // Simular registro de actividad
            const activities = [
                { action: 'login', details: 'Inicio de sesi√≥n', time: new Date(Date.now() - 3600000) },
                { action: 'file_edit', details: 'Archivo editado: index.js', time: new Date(Date.now() - 1800000) },
                { action: 'command', details: 'Comando ejecutado: ls -la', time: new Date(Date.now() - 900000) },
                { action: 'logout', details: 'Cierre de sesi√≥n', time: new Date(Date.now() - 600000) }
            ];
            
            const content = `
                <div style="max-height: 400px; overflow-y: auto;">
                    ${activities.map((act, i) => `
                        <div style="padding: 10px; margin-bottom: 5px; background: rgba(255,255,255,0.05); border-radius: 5px;">
                            <div style="display: flex; justify-content: space-between;">
                                <strong style="color: var(--accent-primary);">${act.action}</strong>
                                <small style="color: var(--text-secondary);">${act.time.toLocaleTimeString()}</small>
                            </div>
                            <div style="color: var(--text-primary); font-size: 0.9rem;">${act.details}</div>
                        </div>
                    `).join('')}
                </div>
                <div class="modal-actions">
                    <button class="btn-secondary" onclick="closeModal()">Cerrar</button>
                    <button class="btn-primary" onclick="exportActivityLog()">Exportar</button>
                </div>
            `;
            
            showModal('Registro de Actividad', 'Historial de actividades del usuario', content);
        }

        function exportActivityLog() {
            showToast('Registro de actividad exportado', 'success');
            closeModal();
        }

        function exportAllSettings() {
            const settings = {
                userSettings,
                exportDate: new Date().toISOString(),
                version: '2.0.0'
            };
            
            const dataStr = JSON.stringify(settings, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `astafile_settings_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Configuraci√≥n exportada', 'success');
        }

        // ============================================
        // HERRAMIENTAS DEL SISTEMA
        // ============================================
        
        function cleanTempFiles() {
            if (confirm('¬øLimpiar archivos temporales?')) {
                showToast('Limpiando archivos temporales...', 'info');
                // Aqu√≠ enviar√≠as el comando al servidor
                setTimeout(() => {
                    showToast('Archivos temporales limpiados', 'success');
                }, 2000);
            }
        }

        function cleanLogs() {
            if (confirm('¬øLimpiar todos los logs del sistema?')) {
                clearSystemLogs();
                showToast('Logs del sistema limpiados', 'success');
            }
        }

        function clearCache() {
            if (confirm('¬øLimpiar cach√© del sistema?')) {
                localStorage.removeItem('astafile_cache');
                showToast('Cach√© limpiado', 'success');
            }
        }

        function optimizeDatabase() {
            showToast('Optimizando base de datos...', 'info');
            // Aqu√≠ enviar√≠as el comando al servidor
            setTimeout(() => {
                showToast('Base de datos optimizada', 'success');
            }, 3000);
        }

        function createBackup() {
            showToast('Creando backup del sistema...', 'info');
            // Aqu√≠ enviar√≠as el comando al servidor
            setTimeout(() => {
                showToast('Backup creado exitosamente', 'success');
            }, 4000);
        }

        function restoreBackup() {
            if (confirm('¬øRestaurar sistema desde backup? Esto sobrescribir√° la configuraci√≥n actual.')) {
                showToast('Restaurando sistema desde backup...', 'warning');
                // Aqu√≠ enviar√≠as el comando al servidor
                setTimeout(() => {
                    showToast('Sistema restaurado exitosamente', 'success');
                }, 5000);
            }
        }

        function runDiagnostic() {
            showToast('Ejecutando diagn√≥stico del sistema...', 'info');
            
            // Simular diagn√≥stico
            const diagnostics = [
                { check: 'Conexi√≥n WebSocket', status: socket?.connected ? '‚úÖ OK' : '‚ùå Error' },
                { check: 'Autenticaci√≥n', status: authToken ? '‚úÖ OK' : '‚ùå Error' },
                { check: 'Memoria Disponible', status: '‚úÖ OK' },
                { check: 'Espacio en Disco', status: '‚úÖ OK' },
                { check: 'Conexi√≥n a Base de Datos', status: '‚úÖ OK' }
            ];
            
            const content = `
                <div style="max-height: 400px; overflow-y: auto;">
                    ${diagnostics.map(d => `
                        <div style="padding: 10px; margin-bottom: 5px; background: rgba(255,255,255,0.05); border-radius: 5px; display: flex; justify-content: space-between;">
                            <span>${d.check}</span>
                            <strong style="color: ${d.status.includes('‚úÖ') ? 'var(--success)' : 'var(--error)'}">${d.status}</strong>
                        </div>
                    `).join('')}
                </div>
                <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                    <strong>Resumen:</strong> ${diagnostics.filter(d => d.status.includes('‚úÖ')).length} de ${diagnostics.length} checks pasados
                </div>
                <div class="modal-actions">
                    <button class="btn-secondary" onclick="closeModal()">Cerrar</button>
                    <button class="btn-primary" onclick="fixDiagnosticIssues()">Reparar Problemas</button>
                </div>
            `;
            
            showModal('Diagn√≥stico del Sistema', 'Resultados del chequeo del sistema', content);
        }

        function fixDiagnosticIssues() {
            showToast('Reparando problemas detectados...', 'info');
            setTimeout(() => {
                showToast('Problemas reparados exitosamente', 'success');
                closeModal();
            }, 3000);
        }

        function showSystemInfo() {
            const info = {
                'Versi√≥n AstaFile': '2.0.0',
                'Navegador': navigator.userAgent,
                'Resoluci√≥n': `${window.screen.width}x${window.screen.height}`,
                'Online': navigator.onLine ? 'S√≠' : 'No',
                'Cookies Habilitadas': navigator.cookieEnabled ? 'S√≠' : 'No',
                'Idioma': navigator.language,
                'Plataforma': navigator.platform,
                'User Agent': navigator.userAgent
            };
            
            const content = `
                <div style="max-height: 400px; overflow-y: auto;">
                    ${Object.entries(info).map(([key, value]) => `
                        <div style="padding: 10px; margin-bottom: 5px; background: rgba(255,255,255,0.05); border-radius: 5px; display: flex; justify-content: space-between;">
                            <span style="color: var(--text-secondary);">${key}:</span>
                            <span style="font-family: 'Fira Code', monospace;">${value}</span>
                        </div>
                    `).join('')}
                </div>
                <div class="modal-actions">
                    <button class="btn-secondary" onclick="closeModal()">Cerrar</button>
                    <button class="btn-primary" onclick="copySystemInfo()">Copiar Informaci√≥n</button>
                </div>
            `;
            
            showModal('Informaci√≥n del Sistema', 'Detalles t√©cnicos del sistema', content);
        }

        function copySystemInfo() {
            const info = `AstaFile Pro v2.0 - Informaci√≥n del Sistema\n${new Date().toLocaleString()}\n\n`;
            navigator.clipboard.writeText(info).then(() => {
                showToast('Informaci√≥n copiada al portapapeles', 'success');
            });
        }

        // ============================================
        // MODALES Y OPERACIONES DE ARCHIVOS
        // ============================================
        
        function showModal(title, subtitle, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalSubtitle').textContent = subtitle;
            document.getElementById('modalContent').innerHTML = content;
            document.getElementById('modalOverlay').classList.add('active');
            
            // Enfocar primer input si existe
            setTimeout(() => {
                const firstInput = document.querySelector('#modalContent input, #modalContent textarea');
                if (firstInput) firstInput.focus();
            }, 100);
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('active');
        }

        function showCreateModal() {
            const content = `
                <div class="form-group">
                    <label><i class="fas fa-file"></i> Nombre del archivo</label>
                    <input type="text" id="newFileName" placeholder="ejemplo.js" autofocus>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-code"></i> Contenido inicial</label>
                    <textarea id="newFileContent" placeholder="// Escribe tu c√≥digo aqu√≠..."></textarea>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-folder"></i> Ubicaci√≥n</label>
                    <input type="text" value="${currentPath}" readonly style="background: rgba(255,255,255,0.05);">
                </div>
                <div class="modal-actions">
                    <button class="btn-secondary" onclick="closeModal()">Cancelar</button>
                    <button class="btn-primary" onclick="createFile()">Crear Archivo</button>
                </div>
            `;
            showModal('Crear Nuevo Archivo', 'Define el nombre y contenido del archivo', content);
        }

        function showCreateFolderModal() {
            const content = `
                <div class="form-group">
                    <label><i class="fas fa-folder"></i> Nombre de la carpeta</label>
                    <input type="text" id="newFolderName" placeholder="mi-carpeta" autofocus>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-folder"></i> Ubicaci√≥n</label>
                    <input type="text" value="${currentPath}" readonly style="background: rgba(255,255,255,0.05);">
                </div>
                <div class="modal-actions">
                    <button class="btn-secondary" onclick="closeModal()">Cancelar</button>
                    <button class="btn-primary" onclick="createFolder()">Crear Carpeta</button>
                </div>
            `;
            showModal('Crear Nueva Carpeta', 'Define el nombre de la carpeta', content);
        }

        function showUploadModal() {
            const content = `
                <div class="form-group">
                    <label><i class="fas fa-upload"></i> Seleccionar archivos</label>
                    <input type="file" id="uploadFile" multiple onchange="handleFileSelect(this)">
                </div>
                <div id="uploadPreview" style="max-height: 200px; overflow-y: auto;"></div>
                <div class="modal-actions">
                    <button class="btn-secondary" onclick="closeModal()">Cancelar</button>
                    <button class="btn-primary" onclick="uploadFiles()">Subir Archivos</button>
                </div>
            `;
            showModal('Subir Archivos', 'Selecciona uno o varios archivos para subir', content);
        }

        async function createFile() {
            const name = document.getElementById('newFileName').value;
            const content = document.getElementById('newFileContent').value;

            if (!name) {
                showToast('El nombre del archivo es requerido', 'error');
                return;
            }

            try {
                const response = await fetch('/api/files/create', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ path: currentPath, name, content })
                });

                const data = await response.json();

                if (data.success) {
                    showToast('‚úÖ Archivo creado exitosamente', 'success');
                    closeModal();
                    loadFiles();
                } else {
                    showToast(data.error || 'Error creando archivo', 'error');
                }
            } catch (error) {
                showToast('Error creando archivo', 'error');
            }
        }

        async function createFolder() {
            const name = document.getElementById('newFolderName').value;

            if (!name) {
                showToast('El nombre de la carpeta es requerido', 'error');
                return;
            }

            try {
                const response = await fetch('/api/files/mkdir', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ path: currentPath, name })
                });

                const data = await response.json();

                if (data.success) {
                    showToast('‚úÖ Carpeta creada exitosamente', 'success');
                    closeModal();
                    loadFiles();
                } else {
                    showToast(data.error || 'Error creando carpeta', 'error');
                }
            } catch (error) {
                showToast('Error creando carpeta', 'error');
            }
        }

        async function deleteSelected() {
            if (selectedFiles.size === 0) {
                showToast('Selecciona archivos o carpetas para eliminar', 'warning');
                return;
            }

            if (!confirm(`¬øEliminar ${selectedFiles.size} elemento(s)? Esta acci√≥n no se puede deshacer.`)) return;

            try {
                const response = await fetch('/api/files/delete', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ paths: Array.from(selectedFiles) })
                });

                const data = await response.json();

                if (data.success) {
                    showToast(`‚úÖ ${selectedFiles.size} elemento(s) eliminado(s)`, 'success');
                    clearSelection();
                    loadFiles();
                } else {
                    showToast(data.error || 'Error eliminando elementos', 'error');
                }
            } catch (error) {
                showToast('Error eliminando elementos', 'error');
            }
        }

        async function renameItem(oldPath) {
            const newName = prompt('Nuevo nombre:', oldPath.split('/').pop());
            if (!newName || newName === oldPath.split('/').pop()) return;

            try {
                const response = await fetch('/api/files/rename', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ oldPath, newName })
                });

                const data = await response.json();

                if (data.success) {
                    showToast('‚úÖ Elemento renombrado exitosamente', 'success');
                    loadFiles();
                } else {
                    showToast(data.error || 'Error renombrando elemento', 'error');
                }
            } catch (error) {
                showToast('Error renombrando elemento', 'error');
            }
        }

        function showFileInfo(filePath) {
            const fileName = filePath.split('/').pop();
            const content = `
                <div class="bot-info">
                    <div class="bot-info-row">
                        <span class="bot-info-label">Nombre:</span>
                        <span class="bot-info-value">${fileName}</span>
                    </div>
                    <div class="bot-info-row">
                        <span class="bot-info-label">Ruta:</span>
                        <span class="bot-info-value">${filePath}</span>
                    </div>
                    <div class="bot-info-row">
                        <span class="bot-info-label">Tipo:</span>
                        <span class="bot-info-value">${getFileType(fileName)}</span>
                    </div>
                    <div class="bot-info-row">
                        <span class="bot-info-label">√öltima modificaci√≥n:</span>
                        <span class="bot-info-value">${new Date().toLocaleString()}</span>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn-secondary" onclick="closeModal()">Cerrar</button>
                    <button class="btn-primary" onclick="editFile('${filePath}'); closeModal();">Abrir para Editar</button>
                </div>
            `;
            showModal('Informaci√≥n del Archivo', 'Detalles del elemento seleccionado', content);
        }

        // ============================================
        // UPLOAD DE ARCHIVOS
        // ============================================
        
        let selectedFilesToUpload = [];

        function handleFileSelect(input) {
            selectedFilesToUpload = Array.from(input.files);
            const preview = document.getElementById('uploadPreview');
            
            if (selectedFilesToUpload.length === 0) {
                preview.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">No hay archivos seleccionados</p>';
                return;
            }

            let html = '<div style="display: grid; gap: 10px;">';
            selectedFilesToUpload.forEach((file, index) => {
                html += `
                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                        <i class="fas fa-file" style="color: var(--accent-secondary);"></i>
                        <div style="flex: 1;">
                            <div style="font-weight: 500;">${file.name}</div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">${formatBytes(file.size)}</div>
                        </div>
                        <span style="font-size: 0.8rem; color: var(--text-secondary);">${index + 1}</span>
                    </div>
                `;
            });
            html += `</div><p style="margin-top: 10px; color: var(--text-secondary); text-align: center;">Total: ${selectedFilesToUpload.length} archivo(s)</p>`;
            
            preview.innerHTML = html;
        }

        async function uploadFiles() {
            if (selectedFilesToUpload.length === 0) {
                showToast('Selecciona archivos para subir', 'error');
                return;
            }

            showLoading();
            let successCount = 0;
            let errorCount = 0;

            for (const file of selectedFilesToUpload) {
                try {
                    const base64 = await readFileAsBase64(file);
                    
                    const response = await fetch('/api/files/upload', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            path: currentPath,
                            name: file.name,
                            content: base64,
                            base64: true
                        })
                    });

                    const data = await response.json();

                    if (data.success) {
                        successCount++;
                    } else {
                        errorCount++;
                        console.error(`Error subiendo ${file.name}:`, data.error);
                    }
                } catch (error) {
                    errorCount++;
                    console.error(`Error subiendo ${file.name}:`, error);
                }
            }

            hideLoading();
            closeModal();
            
            if (successCount > 0) {
                showToast(`‚úÖ ${successCount} archivo(s) subido(s) exitosamente`, 'success');
            }
            if (errorCount > 0) {
                showToast(`‚ö†Ô∏è ${errorCount} archivo(s) no se pudieron subir`, 'warning');
            }
            
            loadFiles();
            selectedFilesToUpload = [];
        }

        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // ============================================
        // UTILIDADES Y FUNCIONES AUXILIARES
        // ============================================
        
        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];
            
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }

        function formatTime(seconds) {
            if (!seconds) return '0s';
            
            const days = Math.floor(seconds / 86400);
            const hours = Math.floor((seconds % 86400) / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);
            
            const parts = [];
            if (days > 0) parts.push(`${days}d`);
            if (hours > 0) parts.push(`${hours}h`);
            if (minutes > 0) parts.push(`${minutes}m`);
            if (secs > 0 || parts.length === 0) parts.push(`${secs}s`);
            
            return parts.join(' ');
        }

        function formatTimeAgo(date) {
            const now = new Date();
            const diff = now - new Date(date);
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (days > 0) return `${days} d√≠a${days > 1 ? 's' : ''}`;
            if (hours > 0) return `${hours} hora${hours > 1 ? 's' : ''}`;
            if (minutes > 0) return `${minutes} minuto${minutes > 1 ? 's' : ''}`;
            return 'ahora mismo';
        }

        function truncateText(text, maxLength = 50) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // Ctrl+Shift+S: Guardar todo
                if (e.ctrlKey && e.shiftKey && e.key === 'S') {
                    e.preventDefault();
                    saveFile();
                }
                
                // Ctrl+F: Buscar en archivo actual
                if (e.ctrlKey && e.key === 'f' && !e.shiftKey) {
                    e.preventDefault();
                    if (document.querySelector('#editorView.active')) {
                        findInFile();
                    }
                }
                
                // Ctrl+L: Limpiar consola
                if (e.ctrlKey && e.key === 'l') {
                    e.preventDefault();
                    if (document.querySelector('#consoleView.active')) {
                        clearConsole();
                    }
                }
                
                // Esc: Cerrar modal
                if (e.key === 'Escape' && document.getElementById('modalOverlay').classList.contains('active')) {
                    closeModal();
                }
                
                // Ctrl+Q: Alternar sidebar
                if (e.ctrlKey && e.key === 'q') {
                    e.preventDefault();
                    toggleSidebar();
                }
            });
        }

        function logUserActivity(action, details) {
            console.log(`üìù Actividad: ${action} - ${details}`);
            // Aqu√≠ podr√≠as enviar el log al servidor
        }

        function showQuickStats() {
            const stats = {
                'Archivos Seleccionados': selectedFiles.size,
                'Historial de Comandos': commandHistory.length,
                'Notificaciones': notifications.length,
                'Tiempo de Sesi√≥n': formatTime((Date.now() - new Date(localStorage.getItem('astafile_last_login')).getTime()) / 1000),
                'Memoria Usada': formatBytes(performance.memory?.usedJSHeapSize || 0),
                'Versi√≥n': 'AstaFile Pro v2.0'
            };
            
            const content = `
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                    ${Object.entries(stats).map(([key, value]) => `
                        <div style="padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                            <div style="font-size: 0.9rem; color: var(--text-secondary);">${key}</div>
                            <div style="font-size: 1.2rem; font-weight: bold; color: var(--accent-primary);">${value}</div>
                        </div>
                    `).join('')}
                </div>
                <div class="modal-actions">
                    <button class="btn-secondary" onclick="closeModal()">Cerrar</button>
                </div>
            `;
            
            showModal('Estad√≠sticas R√°pidas', 'Resumen del sistema y actividad', content);
        }

        function handleFileUpdate(data) {
            // Manejar actualizaciones de archivos en tiempo real
            if (data.path === currentFile) {
                showToast('El archivo ha sido modificado externamente', 'warning');
            }
            
            if (data.path.startsWith(currentPath)) {
                // Recargar la vista si estamos en el directorio afectado
                loadFiles(currentPath);
            }
        }

        function updateBotStatus(data) {
            // Actualizar estado del bot en tiempo real
            if (data.connected !== undefined) {
                updateBotStatusUI(data);
            }
        }

        // ============================================
        // INICIALIZACI√ìN FINAL
        // ============================================
        
        // Asegurar que todas las funciones est√©n disponibles globalmente
        window.handleLogin = handleLogin;
        window.logout = logout;
        window.switchView = switchView;
        window.toggleSidebar = toggleSidebar;
        window.toggleFullscreen = toggleFullscreen;
        window.refreshCurrentView = refreshCurrentView;
        window.navigateTo = navigateTo;
        window.openItem = openItem;
        window.toggleFileSelection = toggleFileSelection;
        window.clearSelection = clearSelection;
        window.refreshFiles = refreshFiles;
        window.saveFile = saveFile;
        window.downloadFile = downloadFile;
        window.formatCode = formatCode;
        window.findInFile = findInFile;
        window.closeEditor = closeEditor;
        window.executeCommand = executeCommand;
        window.startInteractiveShell = startInteractiveShell;
        window.clearConsole = clearConsole;
        window.toggleAutoScroll = toggleAutoScroll;
        window.exportConsoleLogs = exportConsoleLogs;
        window.showCommandHistory = showCommandHistory;
        window.runQuickCommand = runQuickCommand;
        window.startBot = startBot;
        window.restartBot = restartBot;
        window.stopBot = stopBot;
        window.sendBotCommand = sendBotCommand;
        window.showBotConfig = showBotConfig;
        window.showCustomCommandModal = showCustomCommandModal;
        window.sendCustomCommand = sendCustomCommand;
        window.clearBotStats = clearBotStats;
        window.exportBotStats = exportBotStats;
        window.updateBotStats = updateBotStats;
        window.showDetailedStats = showDetailedStats;
        window.clearSystemLogs = clearSystemLogs;
        window.toggleLogsAutoRefresh = toggleLogsAutoRefresh;
        window.filterLogs = filterLogs;
        window.searchLogs = searchLogs;
        window.showLogSettings = showLogSettings;
        window.exportSystemLogs = exportSystemLogs;
        window.saveUserSettings = saveUserSettings;
        window.resetUserSettings = resetUserSettings;
        window.toggleTheme = toggleTheme;
        window.changeTheme = changeTheme;
        window.changePassword = changePassword;
        window.refreshSession = refreshSession;
        window.closeOtherSessions = closeOtherSessions;
        window.showActivityLog = showActivityLog;
        window.exportActivityLog = exportActivityLog;
        window.exportAllSettings = exportAllSettings;
        window.cleanTempFiles = cleanTempFiles;
        window.cleanLogs = cleanLogs;
        window.clearCache = clearCache;
        window.optimizeDatabase = optimizeDatabase;
        window.createBackup = createBackup;
        window.restoreBackup = restoreBackup;
        window.runDiagnostic = runDiagnostic;
        window.showSystemInfo = showSystemInfo;
        window.showCreateModal = showCreateModal;
        window.showCreateFolderModal = showCreateFolderModal;
        window.showUploadModal = showUploadModal;
        window.createFile = createFile;
        window.createFolder = createFolder;
        window.deleteSelected = deleteSelected;
        window.renameItem = renameItem;
        window.showFileInfo = showFileInfo;
        window.handleFileSelect = handleFileSelect;
        window.uploadFiles = uploadFiles;
        window.showNotifications = showNotifications;
        window.clearAllNotifications = clearAllNotifications;
        window.showQuickStats = showQuickStats;

        console.log('‚úÖ AstaFile Pro v2.0 completamente cargado y listo');
    </script>
</body>
</html>